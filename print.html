<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Oura</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="installation/index.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/binary_release.html"><strong aria-hidden="true">2.1.</strong> Binary Release</a></li><li class="chapter-item expanded "><a href="installation/from_source.html"><strong aria-hidden="true">2.2.</strong> From Source</a></li><li class="chapter-item expanded "><a href="installation/docker.html"><strong aria-hidden="true">2.3.</strong> Docker</a></li><li class="chapter-item expanded "><a href="installation/kubernetes.html"><strong aria-hidden="true">2.4.</strong> Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="usage/index.html"><strong aria-hidden="true">3.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="usage/watch.html"><strong aria-hidden="true">3.1.</strong> Watch Mode</a></li><li class="chapter-item expanded "><a href="usage/daemon.html"><strong aria-hidden="true">3.2.</strong> Daemon Mode</a></li><li class="chapter-item expanded "><a href="usage/dump.html"><strong aria-hidden="true">3.3.</strong> Dump Mode</a></li><li class="chapter-item expanded "><a href="usage/library.html"><strong aria-hidden="true">3.4.</strong> Library</a></li></ol></li><li class="chapter-item expanded "><a href="filters/index.html"><strong aria-hidden="true">4.</strong> Filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="filters/fingerprint.html"><strong aria-hidden="true">4.1.</strong> Fingerprint</a></li><li class="chapter-item expanded "><a href="filters/selection.html"><strong aria-hidden="true">4.2.</strong> Selection</a></li></ol></li><li class="chapter-item expanded "><a href="sources/index.html"><strong aria-hidden="true">5.</strong> Sources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sources/n2n.html"><strong aria-hidden="true">5.1.</strong> Node-to-Node</a></li><li class="chapter-item expanded "><a href="sources/n2c.html"><strong aria-hidden="true">5.2.</strong> Node-to-Client</a></li></ol></li><li class="chapter-item expanded "><a href="sinks/index.html"><strong aria-hidden="true">6.</strong> Sinks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sinks/terminal.html"><strong aria-hidden="true">6.1.</strong> Terminal</a></li><li class="chapter-item expanded "><a href="sinks/kafka.html"><strong aria-hidden="true">6.2.</strong> Kafka</a></li><li class="chapter-item expanded "><a href="sinks/elastic.html"><strong aria-hidden="true">6.3.</strong> Elasticsearch</a></li><li class="chapter-item expanded "><a href="sinks/webhook.html"><strong aria-hidden="true">6.4.</strong> Webhook</a></li><li class="chapter-item expanded "><a href="sinks/logs.html"><strong aria-hidden="true">6.5.</strong> Logs</a></li><li class="chapter-item expanded "><a href="sinks/aws_sqs.html"><strong aria-hidden="true">6.6.</strong> AWS SQS</a></li><li class="chapter-item expanded "><a href="sinks/aws_lambda.html"><strong aria-hidden="true">6.7.</strong> AWS Lambda</a></li><li class="chapter-item expanded "><a href="sinks/aws_s3.html"><strong aria-hidden="true">6.8.</strong> AWS S3</a></li><li class="chapter-item expanded "><a href="sinks/redis_streams.html"><strong aria-hidden="true">6.9.</strong> Redis Streams</a></li></ol></li><li class="chapter-item expanded "><a href="reference/index.html"><strong aria-hidden="true">7.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="reference/data_dictionary.html"><strong aria-hidden="true">7.1.</strong> Data Dictionary</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/index.html"><strong aria-hidden="true">8.</strong> Advanced Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/stateful_cursor.html"><strong aria-hidden="true">8.1.</strong> Stateful Cursor</a></li><li class="chapter-item expanded "><a href="advanced/rollback_buffer.html"><strong aria-hidden="true">8.2.</strong> Rollback Buffer</a></li><li class="chapter-item expanded "><a href="advanced/pipeline_metrics.html"><strong aria-hidden="true">8.3.</strong> Pipeline Metrics</a></li><li class="chapter-item expanded "><a href="advanced/mapper_options.html"><strong aria-hidden="true">8.4.</strong> Mapper Options</a></li><li class="chapter-item expanded "><a href="advanced/intersect_options.html"><strong aria-hidden="true">8.5.</strong> Intersect Options</a></li><li class="chapter-item expanded "><a href="advanced/custom_network.html"><strong aria-hidden="true">8.6.</strong> Custom Network</a></li><li class="chapter-item expanded "><a href="advanced/retry_policy.html"><strong aria-hidden="true">8.7.</strong> Retry Policy</a></li></ol></li><li class="chapter-item expanded "><a href="guides/index.html"><strong aria-hidden="true">9.</strong> Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guides/cardano_2_kafka.html"><strong aria-hidden="true">9.1.</strong> Cardano =&gt; Kafka</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Oura</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>We have tools to &quot;explore&quot; the Cardano blockchain, which are useful when you know what you're looking for. We argue that there's a different, complementary use-case which is to &quot;observe&quot; the blockchain and react to particular event patterns.</p>
<p><em>Oura</em> is a rust-native implementation of a pipeline that connects to the tip of a Cardano node through a combination of <em>Ouroboros</em> mini-protocol (using either a unix socket or tcp bearer), filters the events that match a particular pattern and then submits a succinct, self-contained payload to pluggable observers called &quot;sinks&quot;.</p>
<h2 id="etymology"><a class="header" href="#etymology">Etymology</a></h2>
<p>The name of the tool is inspired by the <code>tail</code> command available in unix-like systems which is used to display the tail end of a text file or piped data. Cardano's consensus protocol name, <em>Ouroboros</em>, is a reference to the ancient symbol depicting a serpent or dragon eating its own tail, which means &quot;tail eating&quot;. &quot;Oura&quot; is the ancient greek word for &quot;tail&quot;.</p>
<h2 id="under-the-hood"><a class="header" href="#under-the-hood">Under the Hood</a></h2>
<p>All the heavy lifting required to communicate with the Cardano node is done by the <a href="https://github.com/txpipe/pallas">Pallas</a> library, which provides an implementation of the Ouroboros multiplexer and a few of the required mini-protocol state-machines (ChainSync and LocalState in particular).</p>
<p>The data pipeline makes heavy use (maybe a bit too much) of multi-threading and mpsc channels provided by Rust's <code>std::sync</code> library.</p>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<h3 id="cli-to-watch-live-transactions"><a class="header" href="#cli-to-watch-live-transactions">CLI to Watch Live Transactions</a></h3>
<p>You can run <code>oura watch &lt;socket&gt;</code> to print TX data into the terminal from the tip of a local or remote node. It can be useful as a debugging tool for developers or if you're just curious to see what's going on in the network (for example, to see airdrops as they happen or oracles posting new information).</p>
<h3 id="as-a-bridge-to-other-persistence-mechanisms"><a class="header" href="#as-a-bridge-to-other-persistence-mechanisms">As a Bridge to Other Persistence Mechanisms</a></h3>
<p>Similar to the well-known db-sync tool provided by IOHK, <em>Oura</em> can be used as a daemon to follow a node and output the data into a different data storage technology more suited for your final use-case. The main difference with db-sync is that <em>Oura</em> was designed for easy integration with data-streaming pipelines instead of relational databases.</p>
<p>Given its small memory / cpu footprint, <em>Oura</em> can be deployed side-by-side with your Cardano node even in resource-constrained environments, such as Raspberry PIs.</p>
<h3 id="as-a-trigger-of-custom-actions"><a class="header" href="#as-a-trigger-of-custom-actions">As a Trigger of Custom Actions</a></h3>
<p><em>Oura</em> running in <code>daemon</code> mode can be configured to use custom filters to pinpoint particular transaction patterns and trigger actions whenever it finds a match. For example: send an email when a particular policy / asset combination appears in a transaction; call an AWS Lambda function when a wallet delegates to a particular pool; send a http-call to a webhook each time a metadata key appears in the TX payload;</p>
<h3 id="as-a-library-for-custom-scenarios"><a class="header" href="#as-a-library-for-custom-scenarios">As a Library for Custom Scenarios</a></h3>
<p>If the available out-of-the-box features don't satisfy your particular use-case, <em>Oura</em> can be used a library in your Rust project to set up tailor-made pipelines. Each component (sources, filters, sinks, etc) in <em>Oura</em> aims at being self-contained and reusable. For example, custom filters and sinks can be built while reusing the existing sources.</p>
<h2 id="experimental-windows-support"><a class="header" href="#experimental-windows-support">(Experimental) Windows Support</a></h2>
<p><em>Oura</em> Windows support is currently <strong>experimental</strong>, Windows build supports only <a href="./sources/n2n.html">Node-to-Node</a> source with tcp socket bearer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>Depending on your needs, <em>Oura</em> provides different installation options:</p>
<ul>
<li><a href="installation/binary_release.html">Binary Release</a>: to use one of our pre-compiled binary releases for the supported platforms.</li>
<li><a href="installation/from_source.html">From Source</a>: to compile a binary from source code using Rust's toolchain</li>
<li><a href="installation/docker.html">Docker</a>: to run the tool from a pre-built docker image</li>
<li><a href="installation/kubernetes.html">Kubernetes</a>: to deploy <em>Oura</em> as a resource within a Kubernetes cluster</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-releases"><a class="header" href="#binary-releases">Binary Releases</a></h1>
<p>Oura can be run as a standalone executable. Follow the instructions for your particular OS / Platform to install a local copy from our Github pre-built releases.</p>
<h2 id="macos"><a class="header" href="#macos">MacOS</a></h2>
<p>Use the following command to download and install <em>Oura's</em> binary release for MacOS:</p>
<pre><code class="language-sh">curl --silent --location https://git.io/JD2iH | \
    tar xz -C /tmp &amp;&amp; mv /tmp/oura /usr/local/bin
</code></pre>
<h2 id="gnulinux"><a class="header" href="#gnulinux">GNU/Linux</a></h2>
<p>Use the following command to download and install <em>Oura's</em> binary release for GNU/Linux:</p>
<pre><code class="language-sh">curl --silent --location https://git.io/JD2ix | \
    tar xz -C /tmp &amp;&amp; mv /tmp/oura /usr/local/bin
</code></pre>
<p>Check the <a href="https://github.com/txpipe/oura/releases/latest">latest release</a> for more binary download options.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="from-source"><a class="header" href="#from-source">From Source</a></h1>
<p>The following instructions show how to build and install <em>Oura</em> from source code.</p>
<h2 id="pre-requisites"><a class="header" href="#pre-requisites">Pre-requisites</a></h2>
<ul>
<li>Rust toolchain</li>
</ul>
<h2 id="procedure"><a class="header" href="#procedure">Procedure</a></h2>
<pre><code>git clone git@github.com:txpipe/oura.git
cd oura
cargo install --all-features --path .
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<p><em>Oura</em> provides already built public Docker images through Github Packages. To execute <em>Oura</em> via Docker, use the following command:</p>
<pre><code class="language-sh">docker run ghcr.io/txpipe/oura:latest
</code></pre>
<p>The result of the above command should show <em>Oura's</em> command-line help message.</p>
<h2 id="entry-point"><a class="header" href="#entry-point">Entry Point</a></h2>
<p>The entry-point of the image points to <em>Oura</em> executable. You can pass the same command-line arguments that you would pass to the binary release running bare-metal. For example:</p>
<pre><code>docker run -it ghcr.io/txpipe/oura:latest \
    watch relays-new.cardano-mainnet.iohk.io:3001 \
    --bearer tcp
</code></pre>
<p>For more information on available command-line arguments, check the <a href="installation/../usage/index.html">usage</a> section.</p>
<h2 id="using-a-configuration-file"><a class="header" href="#using-a-configuration-file">Using a Configuration File</a></h2>
<p>The default daemon configuration file for <em>Oura</em> is located in <code>/etc/oura/daemon.toml</code>. To run <em>Oura</em> in daemon mode with a custom configuration file, you need to mount it in the correct location. The following example runs a docker container in background using a configuration file named <code>daemon.toml</code> located in the current folder:</p>
<pre><code>docker run -d -v $(pwd)/daemon.toml:/etc/oura/daemon.toml \
    ghcr.io/txpipe/oura:latest daemon
</code></pre>
<h2 id="versioned-images"><a class="header" href="#versioned-images">Versioned Images</a></h2>
<p>Images are also tagged with the corresponding version number. It is highly recommended to use a fixed image version in production environments to avoid the effects of new features being included in each release (please remember Oura hasn't reached v1 stability guarantees).</p>
<p>To use a versioned image, replace the <code>latest</code> tag by the desired version with the <code>v</code> prefix. For example, to use version <code>1.0.0</code>, use the following image:</p>
<pre><code>ghcr.io/txpipe/oura:v1.0.0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h1>
<p><em>Oura</em> running in <code>daemon</code> mode can be installed can be deployed in Kubernetes cluster, Depending on your needs, we recommend any of the following approaches.</p>
<h2 id="approach-1-sidecar-container"><a class="header" href="#approach-1-sidecar-container">Approach #1: Sidecar Container</a></h2>
<p><em>Oura</em> can be loaded as a sidecar container in the same pod as your Cardano node. Since containers in a pod share the same file-system layer, it's easy to point <em>Oura</em> to the unix-socket of the node.</p>
<p>In the following example yaml, we show a redacted version of a Cardano node resource defined a s Kubernetes STS. Pay attention on the extra container and to the volume mounts to share the unix socket.</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: cardano-node
spec:

  # REDACTED: here goes your normal cardano node sts / deployment spec

  template:
    spec:

      # REDACTED: here goes your normal cardano node pod specs

      containers:
      - name: main

        # REDACTED: here goes your normal cardano node container properties

        # add a new volume mount to enable the socket to be
        # consumed by the 2nd container in the pod (Oura)
        volumeMounts:
        - mountPath: /opt/cardano/cnode/sockets/node0.socket
          name: unix-socket

      # add a 2nd container pointing to the _Oura_ image
      - name: oura
        image: ghcr.io/txpipe/oura:latest

        # we mount the same volume that the main container uses as the source
        # for the Cardano node unix socket.
        volumeMounts:
        - mountPath: /opt/cardano/cnode/sockets/node0.socket
          name: unix-socket
        - mountPath: /etc/oura
          name: oura-config

      volumes:

      # REDACTED: here goes any required volume for you normal cardano node setup

      # empty-dir volume to share the unix socket between containers
      - name: unix-socket
        emptyDir: {}

      # a config map resource with Oura's config particular for your requirements
      - name: oura-config
        configMap:
          name: oura-config
</code></pre>
<h2 id="approach-2-standalone-deployment"><a class="header" href="#approach-2-standalone-deployment">Approach #2: Standalone Deployment</a></h2>
<p><em>Oura</em> can be implemented as a standalone Kubernetes <code>deployment</code> resource. This is useful if your Cardano node is not part of your Kubernetes cluster or if you want to keep your node strictly isolated from the access of a sidecard pod.</p>
<p>Please note that the amount of replicas is set to <code>1</code>. <em>Oura</em> doesn't have any kind of &quot;coordination&quot; between instances. Adding more than one replica will just create extra pipelines duplicating the same work.</p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: oura
data:
  daemon.toml: |-
    [source]
    # REDACTED: here goes your `source` configuration options

    [[filters]]
    # REDACTED: here goes your `filters` configuration options

    [sink]
    # REDACTED: here goes your `sink` configuration options
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: oura
  labels:
    app: oura
spec:
  replicas: 1
  selector:
    matchLabels:
      app: oura
  template:
    metadata:
      labels:
        app: oura
    spec:
      containers:
      - name: main
        image: ghcr.io/txpipe/oura:latest
        env:
          - name: &quot;RUST_LOG&quot;
            value: &quot;info&quot;
        resources:
          requests:
            memory: 50Mi
            cpu: 50m
          limits:
            memory: 200Mi
            cpu: 200m
        args:
          - &quot;daemon&quot;
        volumeMounts:
          - mountPath: /etc/oura
            name: config
      volumes:
      - name: config
        configMap:
          name: oura
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p><em>Oura</em> provides three different execution modes:</p>
<ul>
<li><a href="usage/daemon.html">Daemon</a>: a fully-configurable pipeline that runs in the background. Sources, filters and sinks can be combined to fulfil particular use-cases.</li>
<li><a href="usage/watch.html">Watch</a>: to watch live block events from a node directly in the terminal. It is meant for humans, it uses colors and throttling to facilitate reading.</li>
<li><a href="usage/dump.html">Dump</a>: to dump live block events from a node into rotation log files or stdout. It uses JSONL format for persistence of the events.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="watch-mode"><a class="header" href="#watch-mode">Watch Mode</a></h1>
<p>The <code>watch</code> mode provides a quick way to tail the latest events from the blockchain. It connects directly to a Cardano node using either node-to-client or node-to-node protocols. The output is sent into the terminal in a human-readable fashion.</p>
<p>The output is colorized by type of event and dynamically truncated to fit the width of the terminal. The speed of the output lines is throttled to facilitate visual inspection of each even, otherwise, all events for a block would be output simultaneously.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>To start <em>Oura</em> in watch mode, use the following command from your terminal:</p>
<pre><code>oura watch [OPTIONS] &lt;socket&gt;
</code></pre>
<ul>
<li><code>&lt;socket&gt;</code>: this a required argument that specifies how to connect to the cardano node. It can either be a tcp address (<code>&lt;host&gt;:&lt;port&gt;</code> syntax) or a file path pointing to the location of the unix socket.</li>
</ul>
<h3 id="options"><a class="header" href="#options">Options</a></h3>
<ul>
<li><code>--bearer &lt;bearer&gt;</code>: an option that specifies the type of bearer to use. Possible values are <code>tcp</code> and <code>unix</code>. If omitted, the value <code>unix</code> is used as default.</li>
<li><code>--magic &lt;magic&gt;</code>: the magic number of the network you're connecting to. Possible values are <code>mainnet</code>, <code>testnet</code>, <code>preview</code>, <code>preprod</code> or a numeric value. If omitted, the value <code>mainnet</code> is used as default.</li>
<li><code>--mode &lt;mode&gt;</code>: an option to force the which set of mini-protocols to use when connecting to the Cardano node. Possible values: <code>node</code> and <code>client</code>.  If omitted, <em>Oura</em> will infer the standard protocols for the specified bearer.</li>
<li><code>--since &lt;slot&gt;,&lt;hash&gt;</code>: an option to specify from which point in the chain <em>Oura</em> should start reading from. The point is referenced by passing the slot of the block followed by a comma and the hash of the block (<code>&lt;slot&gt;,&lt;hash&gt;</code>). If omitted, <em>Oura</em> will start reading from the tail (tip) of the node.</li>
<li><code>--wrap</code>: indicates that long output text should break and continue in the following line. If omitted, lines will be truncated to fit in the available terminal width.</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="watch-live-data-from-a-remote-relay-node"><a class="header" href="#watch-live-data-from-a-remote-relay-node">Watch Live Data From A Remote Relay Node</a></h3>
<pre><code class="language-sh">oura watch relays-new.cardano-mainnet.iohk.io:3001 --bearer tcp
</code></pre>
<h3 id="watch-live-data-from-a-local-node-via-unix-socket"><a class="header" href="#watch-live-data-from-a-local-node-via-unix-socket">Watch Live Data From A Local Node Via Unix Socket</a></h3>
<pre><code class="language-sh">oura watch /opt/cardano/cnode/sockets/node0.socket --bearer unix
</code></pre>
<h3 id="watch-live-data-from-the-tip-of-a-local-testnet-node"><a class="header" href="#watch-live-data-from-the-tip-of-a-local-testnet-node">Watch Live Data From The Tip Of A Local Testnet Node</a></h3>
<pre><code class="language-sh">oura watch /opt/cardano/cnode/sockets/node0.socket --bearer unix --magic testnet
</code></pre>
<h3 id="watch-data-starting-at-a-particular-block"><a class="header" href="#watch-data-starting-at-a-particular-block">Watch Data Starting At A Particular Block</a></h3>
<pre><code class="language-sh">oura watch relays-new.cardano-mainnet.iohk.io:3001 \
    --bearer tcp \
    --since 49159253,d034a2d0e4c3076f57368ed59319010c265718f0923057f8ff914a3b6bfd1314
</code></pre>
<h3 id="watch-live-data-from-the-preview-testnet"><a class="header" href="#watch-live-data-from-the-preview-testnet">Watch Live Data From the &quot;Preview&quot; testnet</a></h3>
<pre><code class="language-sh">oura watch preview-node.world.dev.cardano.org:30002 --bearer tcp --magic preview
</code></pre>
<h3 id="watch-live-data-from-the-pre-production-testnet"><a class="header" href="#watch-live-data-from-the-pre-production-testnet">Watch Live Data From the &quot;Pre-Production&quot; testnet</a></h3>
<pre><code class="language-sh">oura watch preprod-node.world.dev.cardano.org:30000 --bearer tcp --magic preprod
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="daemon-mode"><a class="header" href="#daemon-mode">Daemon Mode</a></h1>
<p><em>Oura's</em> <code>daemon</code> mode processes data in the background, without any live output. This mode is used in scenarios where you need to continuously bridge blockchain data with other persistence mechanisms or to trigger an automated process in response to a particular event pattern.</p>
<h2 id="start-daemon-mode"><a class="header" href="#start-daemon-mode">Start Daemon Mode</a></h2>
<p>To start <em>Oura</em> in <em>daemon mode</em>, use the following command:</p>
<pre><code>oura daemon
</code></pre>
<p>Available options:</p>
<ul>
<li><code>--config</code>: path of a custom toml configuration file to use. If not specified, configuration will be loaded from <code>/etc/oura/daemon.toml</code>.</li>
<li><code>--cursor</code>: a custom point in the chain to use as starting point. Expects format: <code>slot,hex-hash</code>. If not specified, it will look for the <a href="usage/../advanced/stateful_cursor.html">cursor</a> section available via toml configuration or fallback to the <a href="usage/../advanced/intersect_options.html">intersect options</a> of the source stage.</li>
</ul>
<p>Example of starting daemon mode with default config file:</p>
<pre><code class="language-sh"># config will be loaded from /etc/oura/daemon.toml
oura daemon
</code></pre>
<p>Example of starting daemon mode with a custom config file at <code>my_config.toml</code>:</p>
<pre><code class="language-sh">oura daemon --config my_config.toml
</code></pre>
<p>Example of starting daemon mode specifying a particular cursor:</p>
<pre><code class="language-sh">oura daemon --cursor 56134714,2d2a5503c16671ac7d5296f8e6bfeee050b2c2900a7d8c97b36c434667eb99d9
</code></pre>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>The configuration file needs to specify the source, filters and sink to use in a particular pipeline. The following toml represent the typical skeleton of an <em>Oura</em> config file:</p>
<pre><code class="language-toml">[source]
type = &quot;X&quot; # the type of source to use

# custom config fields for this source type
foo = &quot;abc&quot;
bar = &quot;xyz&quot;

[[filters]]
type = &quot;Y&quot; # the type of filter to use

# custom config fields for this filter type
foo = &quot;123&quot;
bar = &quot;789&quot;

[sink]
# the type of sink to use
type = &quot;Z&quot;

# custom config fields for this sink type
foo = &quot;123&quot;
bar = &quot;789&quot;

# optional cursor settings, remove seaction to disable feature
[cursor]
type = &quot;File&quot;
path = &quot;/var/oura/cursor&quot;
</code></pre>
<h3 id="the-source-section"><a class="header" href="#the-source-section">The <code>source</code> section</a></h3>
<p>This section specifies the origin of the data. The special <code>type</code> field must always be present and containing a value matching any of the available built-in sources. The rest of the fields in the section will depend on the selected <code>type</code>. See the <a href="usage/../sources/index.html">sources</a> section for a list of available options and their corresponding config values.</p>
<h3 id="the-filters-section"><a class="header" href="#the-filters-section">The <code>filters</code> section</a></h3>
<p>This section specifies a collection of filters that are applied in sequence to each event. The special <code>type</code> field must always be present and containing a value matching any of the available built-in filters. Notice that this section of the config is an array, allowing multiple filter sections per config file. See the <a href="usage/../filters/index.html">filters</a> section for a list of available options and their corresponding config values.</p>
<h3 id="the-sink-section"><a class="header" href="#the-sink-section">The <code>sink</code> section</a></h3>
<p>This section specifies the destination of the data. The special <code>type</code> field must always be present and containing a value matching any of the available built-in sinks. The rest of the fields in the section will depend on the selected <code>type</code>. See the <a href="usage/../sinks/index.html">sinks</a> section for a list of available options.</p>
<h3 id="the-cursor-section"><a class="header" href="#the-cursor-section">The <code>cursor</code> section</a></h3>
<p>This section specifies how to configure the <a href="usage/../advanced/stateful_cursor.html">cursor feature</a>. A cursor is a reference of the current position of the pipeline. If the pipeline needs to restart for whatever reason, and a cursor is available, the pipeline will start reading from that point in the chain. Removing the section from the config will disable the cursor feature.</p>
<h3 id="full-example"><a class="header" href="#full-example">Full Example</a></h3>
<p>Here's an example configuration file that uses a Node-to-Node source and output the events into a Kafka sink:</p>
<pre><code class="language-toml">[source]
type = &quot;N2N&quot;
address = [&quot;Tcp&quot;, &quot;relays-new.cardano-mainnet.iohk.io:3001&quot;]
magic = &quot;mainnet&quot;

[[filters]]
type = &quot;Fingerprint&quot;

[[filters]]
type = &quot;Selection&quot;
predicate = &quot;variant_in&quot;
argument = [&quot;Block&quot;, &quot;Transaction&quot;]

[sink]
type = &quot;Kafka&quot;
brokers = [&quot;127.0.0.1:53147&quot;]
topic = &quot;testnet&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dump-mode"><a class="header" href="#dump-mode">Dump Mode</a></h1>
<p>The <code>dump</code> mode provides a quick way to tail the latest events from the blockchain and outputs raw data into stdout or the file system. It connects directly to a Cardano node using either node-to-client or node-to-node protocols. The output is formatted using JSONL (json, one-line per event). This command is intended mainly as quick persistence mechanism of blockchain data, such as keeping a log of blocks / transactions. It can also be used for &quot;piping&quot; stdout into other shell commands.</p>
<p>If an output path is specified, data will be saved as a set of rotation logs files. Each log file will contain a max of ~50mb. A total of 200 files will be stored before starting to delete the older ones. Gzip is used to compress old files as they are rotated.</p>
<p>For real-time, human-inspection of the events, use the <a href="usage/watch.html">watch command</a>.</p>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<p>To start <em>Oura</em> in dump mode, use the following command from your shell:</p>
<pre><code>oura dump [OPTIONS] &lt;socket&gt;
</code></pre>
<ul>
<li><code>&lt;socket&gt;</code>: this a required argument that specifies how to connect to the cardano node. It can either be a tcp address (<code>&lt;host&gt;:&lt;port&gt;</code> syntax) or a file path pointing to the location of the unix socket.</li>
</ul>
<h3 id="options-1"><a class="header" href="#options-1">Options</a></h3>
<ul>
<li><code>--bearer &lt;bearer&gt;</code>: an option that specifies the type of bearer to use. Possible values are <code>tcp</code> and <code>unix</code>. If omitted, the value <code>unix</code> is used as default.</li>
<li><code>--magic &lt;magic&gt;</code>: the magic number of the network you're connecting to. Possible values are <code>mainnet</code>, <code>testnet</code> or a numeric value. If omitted, the value <code>mainnet</code> is used as default.</li>
<li><code>--mode &lt;mode&gt;</code>: an option to force the which set of mini-protocols to use when connecting to the Cardano node. Possible values: <code>node</code> and <code>client</code>.  If omitted, <em>Oura</em> will infer the standard protocols for the specified bearer.</li>
<li><code>--since &lt;slot&gt;,&lt;hash&gt;</code>: an option to specify from which point in the chain <em>Oura</em> should start reading from. The point is referenced by passing the slot of the block followed by a comma and the hash of the block (<code>&lt;slot&gt;,&lt;hash&gt;</code>). If omitted, <em>Oura</em> will start reading from the tail (tip) of the node.</li>
<li><code>--output &lt;path-like&gt;</code>: an option to specify an output file prefix for storing the log files. Logs are rotated, so a timestamp will be added as a suffix to the final filename. If omitted, data will be sent to stdout.</li>
</ul>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<h3 id="dump-data-from-a-remote-relay-node-into-stdout"><a class="header" href="#dump-data-from-a-remote-relay-node-into-stdout">Dump Data From A Remote Relay Node into Stdout</a></h3>
<pre><code class="language-sh">oura dump relays-new.cardano-mainnet.iohk.io:3001 --bearer tcp
</code></pre>
<h3 id="dump-data-from-a-remote-relay-node-into-rotating-files"><a class="header" href="#dump-data-from-a-remote-relay-node-into-rotating-files">Dump Data From A Remote Relay Node into Rotating Files</a></h3>
<pre><code class="language-sh">oura dump relays-new.cardano-mainnet.iohk.io:3001 --bearer tcp --output ./mainnet-logs
</code></pre>
<h3 id="pipe-data-from-a-remote-relay-node-into-a-new-shell-command"><a class="header" href="#pipe-data-from-a-remote-relay-node-into-a-new-shell-command">Pipe Data From A Remote Relay Node into a new Shell Command</a></h3>
<pre><code class="language-sh">oura dump relays-new.cardano-mainnet.iohk.io:3001 --bearer tcp | grep block
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="library"><a class="header" href="#library">Library</a></h1>
<p>Coming Soon!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filters"><a class="header" href="#filters">Filters</a></h1>
<p><em>Filters</em> are intermediate steps in the pipeline that process events as they travel from <em>sources</em> to <em>sinks</em>. They might serve different pourposes, such as: selecting relevant events, enriching event data, transforming data representation, etc.</p>
<h2 id="built-in-filters"><a class="header" href="#built-in-filters">Built-in Filters</a></h2>
<p>These are the existing filters that are included as part the main <em>Oura</em> codebase:</p>
<ul>
<li><a href="filters/fingerprint.html">Fingerprint</a>: a filter that adds a (probably) unique identifier (fingerprint) to each event.</li>
<li><a href="filters/selection.html">Selection</a>: a filter that evaluates different built-in predicates to decide which events should go through the pipeline.</li>
</ul>
<p>New filters are being developed, information will be added in this documentation to reflect the updated list. Contributions and feature request are welcome in our <a href="https://github.com/txpipe/oura">Github Repo</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fingerprint-filter"><a class="header" href="#fingerprint-filter">Fingerprint Filter</a></h1>
<p>A filter that computes a (probably) unique identifier for each event and appends it as part of the data passed forward.</p>
<p>Dealing with duplicated records is a common problem in data pipelines. A common workaround is to use identifiers based on the hash of the data for each record. In this way, a duplicated record would yield the same hash, allowing the storage engine to discard the extra instance.</p>
<p>The <em>fingerprint</em> filter uses the non-cryptographic hash algorithm <code>murmur3</code> to compute an id for each <em>Oura</em> event with a very low collision level. We use a non-cryptographic hash because they are faster to compute and non of the cryptographic properties are required for this use-case.</p>
<p>When enabled, this filter will set the <code>fingerprint</code> property of the <code>Event</code> data structure passed through each stage of the pipeline. <em>Sinks</em> at the end of the process might leverage this value as primary key of the corresponding storage mechanism.</p>
<h2 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h2>
<p>Adding the following section to the daemon config file will enable the filter as part of the pipeline:</p>
<pre><code class="language-toml">[[filters]]
type = &quot;Fingerprint&quot;
</code></pre>
<h3 id="section-filter"><a class="header" href="#section-filter">Section: <code>filter</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>Fingerprint</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="selection-filter"><a class="header" href="#selection-filter">Selection Filter</a></h1>
<p>A filter that evaluates a set of configurable predicates against each event in the pipeline to decide which records should be sent to the following stage.</p>
<p>Not every use-case requires each and every event to be processed. For example, a pipeline interested in creating a 'metadata' search engine might not care about transaction outputs. With a similar logic, a pipeline aggregating transaction amounts might not care about metadata. The <em>selection filter</em> provides a way to optimize the pipeline so that only relevant events are processed.</p>
<p>The filter works by evaluating a predicate against each event. If the predicate returns <code>true</code>, then the event will continue down the pipeline. If the predicate evalutes to <code>false</code>, the event will be dopped. We currently provide some common built-in predicate to facilitate common use-cases (eg: matching event type, matching policy id, matching a metadata key, etc.). We also provide some 'connecting' predicates like <code>all_of</code>, <code>any_of</code>, and <code>not</code> which can be used to create complex conditions by composing other predicates.</p>
<h2 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h2>
<p>Adding the following section to the daemon config file will enable the filter as part of the pipeline:</p>
<pre><code class="language-toml">[[filters]]
type = &quot;Selection&quot;

[filters.check]
predicate = &quot;&lt;predicate kind&gt;&quot;
argument = &lt;predicate argument&gt;
</code></pre>
<h3 id="section-filters"><a class="header" href="#section-filters">Section: <code>filters</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>Selection</code>.</li>
</ul>
<h3 id="section-filterscheck"><a class="header" href="#section-filterscheck">Section <code>filters.check</code></a></h3>
<ul>
<li><code>predicate</code>: the key of the predicate to use for the evaluation. See the list of available predicates for possible values.</li>
<li><code>argument</code>: a polimorphic argument that specializes the behavior of the predicate in some way.</li>
</ul>
<h2 id="available-predicates"><a class="header" href="#available-predicates">Available Predicates</a></h2>
<ul>
<li><code>variant_in (string[])</code>: This predicate will yield true when the variant of the event matches any of the items in the argument array.</li>
<li><code>variant_not_in (string[])</code>: This predicate will yield true when the variant of the event doesn't match any of the items in the argument array.</li>
<li><code>policy_equals (string)</code>: This predicate will yield true when the policy of a mint or output asset matches the value in the argument.</li>
<li><code>asset_equals (string)</code>: This predicate will yield true when the policy of a mint or output asset matches the value in the argument.</li>
<li><code>metadata_label_equals (string)</code>: This predicate will yield true when the root label of a metadata entry matches the value in the argument.</li>
<li><code>metadata_any_sub_label_equals (string)</code>: This predicate will yield true when <em>at least one</em> of the sub labels in a metadata entry matches the value in the argument.</li>
<li><code>not (predicate)</code>: This predicate will yield true when the predicate in the arguments yields false.</li>
<li><code>any_of (predicate[])</code>: This predicate will yield true when <em>any</em> of the predicates in the argument yields true.</li>
<li><code>all_of (predicate[])</code>: This predicate will yield true when <em>all</em> of the predicates in the argument yields true.</li>
</ul>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<p>Allowing only block and transaction events to pass:</p>
<pre><code class="language-toml">[[filters]]
type = &quot;Selection&quot;

[filters.check]
predicate = &quot;variant_in&quot;
argument = [&quot;Block&quot;, &quot;Transaction&quot;]
</code></pre>
<p>Using the <code>not</code> predicate to allow all events except the variant <code>Transaction</code>:</p>
<pre><code class="language-toml">[[filters]]
type = &quot;Selection&quot;

[filters.check]
predicate = &quot;not&quot;

[filters.check.argument]
predicate = &quot;variant_in&quot;
argument = [&quot;Transaction&quot;]
</code></pre>
<p>Using the <code>any_of</code> predicate to filter events presenting any of two different policies (Boolean &quot;or&quot;):</p>
<pre><code class="language-toml">[filters.check]
predicate = &quot;any_of&quot;

[[filters.check.argument]]
predicate = &quot;policy_equals&quot;
argument = &quot;4bf184e01e0f163296ab253edd60774e2d34367d0e7b6cbc689b567d&quot;

[[filters.check.argument]]
predicate = &quot;policy_equals&quot;
argument = &quot;a5bb0e5bb275a573d744a021f9b3bff73595468e002755b447e01559&quot;
</code></pre>
<p>Using the <code>all_of</code> predicate to filter only &quot;asset&quot; events presenting a particular policy (Boolean &quot;and&quot;) :</p>
<pre><code class="language-toml">[filters.check]
predicate = &quot;all_of&quot;

[[filters.check.argument]]
predicate = &quot;variant_in&quot;
argument = [&quot;OutputAsset&quot;]

[[filters.check.argument]]
predicate = &quot;policy_equals&quot;
argument = &quot;a5bb0e5bb275a573d744a021f9b3bff73595468e002755b447e01559&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sources"><a class="header" href="#sources">Sources</a></h1>
<p>Sources represent the &quot;origin&quot; of the events processed by <em>Oura</em>. Any compatible source is responsible for feeding blockchain data into <em>Oura's</em> pipeline for further processing.</p>
<h2 id="built-in-sources"><a class="header" href="#built-in-sources">Built-in Sources</a></h2>
<p>These are the currently available sources included as part the main <em>Oura</em> codebase:</p>
<ul>
<li><a href="sources/n2n.html">N2N</a>: an Ouroboros agent that connects to a Cardano node using node-2-node protocols</li>
<li><a href="sources/n2c.html">N2C</a>: an Ouroboros agent that connects to a Cardano node using node-2-client protocols</li>
</ul>
<p>New source are being developed, information will be added in this documentation to reflect the updated list. Contributions and feature request are welcome in our <a href="https://github.com/txpipe/oura">Github Repo</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="node-to-node"><a class="header" href="#node-to-node">Node-to-Node</a></h1>
<p>The Node-to-Node (N2N) source uses Ouroboros mini-protocols to connect to a local or remote Cardano node through a tcp socket bearer and fetches block data using the ChainSync mini-protocol instantiated to &quot;headers only&quot; and the BlockFetch mini-protocol for retrieval of the actual block payload.</p>
<h2 id="configuration-3"><a class="header" href="#configuration-3">Configuration</a></h2>
<p>The following snippet shows an example of how to set up a typical N2N source:</p>
<pre><code class="language-toml">[source]
type = &quot;N2N&quot;
address = [&quot;Tcp&quot;, &quot;&lt;hostname:port&gt;&quot;]
magic = &lt;network magic&gt;

[source.intersect]
type = &lt;intersect strategy&gt;
value = &lt;intersect argument&gt;

[source.mapper]
include_block_end_events = &lt;bool&gt;
include_transaction_details = &lt;bool&gt;
include_transaction_end_events = &lt;bool&gt;
include_block_cbor = &lt;bool&gt;
</code></pre>
<h3 id="section-source"><a class="header" href="#section-source">Section <code>source</code>:</a></h3>
<ul>
<li><code>type</code>: this field must be set to the literal value <code>N2N</code></li>
<li><code>address</code>: a tuple describing the location of the tcp endpoint It must be specified as a string with hostname and port number.</li>
<li><code>magic</code>: the magic of the network that the node is running (<code>mainnet</code>, <code>testnet</code> or a custom numeric value)</li>
<li><del><code>since</code></del>: (deprecated, please use <code>intersect</code>) the point in the chain where reading of events should start from. It must be specified as a tuple of slot (integer) and block hash (hex string)</li>
</ul>
<h3 id="section-sourceintersect"><a class="header" href="#section-sourceintersect">Section <code>source.intersect</code></a></h3>
<p>This section provides advanced options for instructing Oura from which point in the chain to start reading from. Read the <a href="sources/../advanced/intersect_options.html">intersect options</a> documentation for detailed information.</p>
<h3 id="section-sourcemapper"><a class="header" href="#section-sourcemapper">Section <code>source.mapper</code></a></h3>
<p>This section provides a way to opt-in into advances behaviour of how the raw chain data is mapped into <em>Oura</em> events. Read the <a href="sources/../advanced/mapper_options.html">mapper options</a> documentation for detailed information.</p>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<p>Connecting to a remote Cardano node in mainnet through tcp sockets:</p>
<pre><code class="language-toml">[source]
type = &quot;N2N&quot;
address = [&quot;Tcp&quot;, &quot;relays-new.cardano-mainnet.iohk.io:3001&quot;]
magic = &quot;mainnet&quot;
</code></pre>
<p>Connecting to a remote Cardano node in testnet through tcp sockets:</p>
<pre><code class="language-toml">[source]
type = &quot;N2N&quot;
address = [&quot;Tcp&quot;, &quot;relays-new.cardano-mainnet.iohk.io:3001&quot;]
magic = &quot;testnet&quot;
</code></pre>
<p>Start reading from a particular point in the chain:</p>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Tcp&quot;, &quot;relays-new.cardano-mainnet.iohk.io:3001&quot;]
magic = &quot;mainnet&quot;

[source.intersect]
type = &quot;Point&quot;
value = [48896539, &quot;5d1f1b6149b9e80e0ff44f442e0cab0b36437bb92eacf987384be479d4282357&quot;]
</code></pre>
<p>Include all details inside the transaction events:</p>
<pre><code class="language-toml">[source]
type = &quot;N2N&quot;
address = [&quot;Tcp&quot;, &quot;relays-new.cardano-mainnet.iohk.io:3001&quot;]
magic = &quot;mainnet&quot;


[source.mapper]
include_transaction_details = true
include_block_cbor = true
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="node-to-client"><a class="header" href="#node-to-client">Node-to-Client</a></h1>
<p>The Node-to-Client (N2C) source uses Ouroboros mini-protocols to connect to a local Cardano node through a unix socket bearer and fetches block data using the ChainSync mini-protocol instantiated to &quot;full blocks&quot;.</p>
<h2 id="configuration-4"><a class="header" href="#configuration-4">Configuration</a></h2>
<p>The following snippet shows an example of how to set up a typical N2C source:</p>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Unix&quot;, &quot;&lt;socket location&gt;&quot;]
magic = &lt;network magic&gt;

[source.intersect]
type = &lt;intersect strategy&gt;
value = &lt;intersect argument&gt;

[source.mapper]
include_block_end_events = &lt;bool&gt;
include_transaction_details = &lt;bool&gt;
include_transaction_end_events = &lt;bool&gt;
include_block_cbor = &lt;bool&gt;
</code></pre>
<h3 id="section-source-1"><a class="header" href="#section-source-1">Section <code>source</code>:</a></h3>
<ul>
<li><code>type</code>: this field must be set to the literal value <code>N2C</code></li>
<li><code>address</code>: a tuple describing the location of the socket</li>
<li><code>magic</code>: the magic of the network that the node is running (<code>mainnet</code>, <code>testnet</code> or a custom numeric value)</li>
<li><del><code>since</code></del>: (deprecated, please use <code>intersect</code>) the point in the chain where reading of events should start from. It must be specified as a tuple of slot (integer) and block hash (hex string)</li>
</ul>
<h3 id="section-sourceintersect-1"><a class="header" href="#section-sourceintersect-1">Section <code>source.intersect</code></a></h3>
<p>This section provides advanced options for instructing Oura from which point in the chain to start reading from. Read the <a href="sources/../advanced/intersect_options.html">intersect options</a> documentation for detailed information.</p>
<h3 id="section-sourcemapper-1"><a class="header" href="#section-sourcemapper-1">Section <code>source.mapper</code></a></h3>
<p>This section provides a way to opt-in into advances behaviour of how the raw chain data is mapped into <em>Oura</em> events. Read the <a href="sources/../advanced/mapper_options.html">mapper options</a> documentation for detailed information.</p>
<h2 id="examples-4"><a class="header" href="#examples-4">Examples</a></h2>
<p>Connecting to a local Cardano node in mainnet through unix sockets:</p>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Unix&quot;, &quot;/opt/cardano/cnode/sockets/node0.socket&quot;]
magic = &quot;mainnet&quot;
</code></pre>
<p>Connecting to a local Cardano node in testnet through unix sockets:</p>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Unix&quot;, &quot;/opt/cardano/cnode/sockets/node0.socket&quot;]
magic = &quot;testnet&quot;
</code></pre>
<p>Start reading from a particular point in the chain:</p>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Unix&quot;, &quot;/opt/cardano/cnode/sockets/node0.socket&quot;]
magic = &quot;mainnet&quot;

[source.intersect]
type = &quot;Point&quot;
value = [48896539, &quot;5d1f1b6149b9e80e0ff44f442e0cab0b36437bb92eacf987384be479d4282357&quot;]
</code></pre>
<p>Include all details inside the transaction events:</p>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Unix&quot;, &quot;/opt/cardano/cnode/sockets/node0.socket&quot;]
magic = &quot;mainnet&quot;


[source.mapper]
include_transaction_details = true
include_block_cbor = true
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sinks"><a class="header" href="#sinks">Sinks</a></h1>
<p>Sinks are the &quot;destination&quot; of the events processed by <em>Oura</em>. They are the concrete link between the internal representation of the data records and the corresponding external service interested in the data. Typical sinks include: database engines, stream-processing engines, web API calls and FaaS solutions.</p>
<h2 id="built-in-sinks"><a class="header" href="#built-in-sinks">Built-in Sinks</a></h2>
<p>These are the existing sinks that are included as part the main <em>Oura</em> codebase:</p>
<ul>
<li><a href="sinks/terminal.html">Terminal</a>: a sink that outputs events into stdout with fancy coloring</li>
<li><a href="sinks/kafka.html">Kakfa</a>: a sink that sends each event into a Kafka topic</li>
<li><a href="sinks/elastic.html">Elasticsearch</a>: a sink that writes events into an Elasticsearch index or data stream.</li>
<li><a href="sinks/webhook.html">Webhook</a>: a sink that outputs each event as an HTTP call to a remote endpoint.</li>
<li><a href="sinks/logs.html">Logs</a>: a sink that saves events to the file system using JSONL text files.</li>
<li><a href="sinks/aws_sqs.html">AWS SQS</a>: a sink that sends each event as message to an AWS SQS queue.</li>
<li><a href="sinks/aws_lambda.html">AWS Lamda</a>: a sink that invokes an AWS Lambda function for each event.</li>
<li><a href="sinks/aws_s3.html">AWS S3</a>: a sink that saves the CBOR content of the blocks as an AWS S3 object.</li>
<li><a href="sinks/redis_streams.html">Redis Streams</a>: a sink that sends each event into a Redis stream.</li>
</ul>
<p>New sinks are being developed, information will be added in this documentation to reflect the updated list. Contributions and feature request are welcome in our <a href="https://github.com/txpipe/oura">Github Repo</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="terminal"><a class="header" href="#terminal">Terminal</a></h1>
<p>A sink that outputs each event into the terminal through stdout using fancy coloring .</p>
<h2 id="configuration-5"><a class="header" href="#configuration-5">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;Terminal&quot;
throttle_min_span_millis = 500
wrap = true
</code></pre>
<ul>
<li><code>type</code> (required): the literal value <code>Terminal</code>.</li>
<li><code>throttle_min_span_millis</code> (optional, default = <code>500</code>): the amount of time (milliseconds) to wait between printing each event into the console. This is used to facilitate the reading for human following the output.</li>
<li><code>wrap</code> (optional, default = <code>false</code>): a true value indicates that long output text should break and continue in the following line. If false, lines will be truncated to fit in the available terminal width.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kafka"><a class="header" href="#kafka">Kafka</a></h1>
<p>A sink that implements a <em>Kafka</em> producer. Each event is json-encoded and sent as a message to a single Kafka topic.</p>
<h2 id="configuration-6"><a class="header" href="#configuration-6">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;Kafka&quot;
brokers = [&quot;kafka-broker-0:9092&quot;]
topic = &quot;cardano-events&quot;
</code></pre>
<ul>
<li><code>type</code>: the literal value <code>Kafka</code>.</li>
<li><code>brokers</code>: indicates the location of the <em>Kafka</em> brokers within the network. Several hostname:port pairs can be added to the array for a &quot;cluster&quot; scenario.</li>
<li><code>topic</code> this field indicates which <em>Kafka</em> topic to use to send the outbound messages.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elasticsearch"><a class="header" href="#elasticsearch">Elasticsearch</a></h1>
<p>A sink that outputs events into an Elasticsearch server. Each event is json-encoded and sent as a message to an index or data stream.</p>
<h2 id="configuration-7"><a class="header" href="#configuration-7">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;Elastic&quot;
url = &quot;https://localhost:9200&quot;
index = &quot;oura.sink.v0.mainnet&quot;

[sink.credentials]
type = &quot;Basic&quot;
username = &quot;oura123&quot;
password = &quot;my very secret stuff&quot;
</code></pre>
<h3 id="section-sink"><a class="header" href="#section-sink">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>Elastic</code>.</li>
<li><code>url</code>: the location of the Elasticsearch's API</li>
<li><code>index</code>: the name of the index (or data stream) to store the event documents</li>
<li><code>idempotency</code> (optional): flag that if enabled will force idempotent calls to ES (to avoid duplicates)</li>
<li><code>retry_policy</code> (optional): controls the policy to retry failed requests (see <a href="sinks/../advanced/retry_policy.html">retry policy</a>)</li>
</ul>
<h3 id="section-sinkcredentials"><a class="header" href="#section-sinkcredentials">Section: <code>sink.credentials</code></a></h3>
<p>This section configures the auth mechanism against Elasticsearch. You can remove the whole section from the configuration if you want to skip authentication altogether (maybe private cluster without auth?).</p>
<p>We currently only implement <em>basic</em> auth, other mechanisms will be implemented at some point.</p>
<ul>
<li><code>type</code>: the mechanism to use for authentication, only <code>Basic</code> is currently implemented</li>
<li><code>username</code>: username of the user with access to Elasticsearch</li>
<li><code>password</code>: password of the user with access to Elasticsearch</li>
</ul>
<h2 id="idempotency"><a class="header" href="#idempotency">Idempotency</a></h2>
<p>In services and API calls, <em>idempotency</em> refers to a property of the system where the execution of multiple &quot;equivalent&quot; requests have the same effect as a single request. In other words, &quot;idempotent&quot; calls can be triggered multiple times without problem.</p>
<p>In our Elasticsearch sink, when the <code>idempotency</code> flag is enabled, each document sent to the index will specify a particular content-based ID: the <a href="sinks/../filters/fingerprint.html">fingerprint</a> of the event. If Oura restarts without having a cursor or if the same block is processed for any reason, repeated events will present the same ID and Elasticsearch will reject them and Oura will continue with the following event. This mechanism provides a strong guarantee that our index won't contain duplicate data.</p>
<p>If the flag is disabled, each document will be generated using a random ID, ensuring that it will be indexed regardless.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="webhook"><a class="header" href="#webhook">Webhook</a></h1>
<p>A sink that outputs each event as an HTTP call to a remote endpoint. Each event is json-encoded and sent as the body of a request using <code>POST</code> method.</p>
<p>The sink expect a 200 reponse code for each HTTP call. If found, the process will continue with the next message. If an error occurs (either at the tcp or http level), the sink will apply the corresponding retry logic as specified in the configuration.</p>
<h2 id="configuration-8"><a class="header" href="#configuration-8">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;Webhook&quot;
url = &quot;https://endpoint:5000/events&quot;
authorization = &quot;user:pass&quot;
timeout = 30000
error_policy = &quot;Continue&quot;

[sink.retry_policy]
max_retries = 30
backoff_unit =  5000
backoff_factor = 2
max_backoff = 100000

[sink.headers]
extra_header_1 = &quot;abc&quot;
extra_header_2 = &quot;123&quot;
</code></pre>
<h3 id="section-sink-1"><a class="header" href="#section-sink-1">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>Webhook</code>.</li>
<li><code>url</code>: url of your remote endpoint (needs to accept POST method)</li>
<li><code>authorization</code> (optional): value to add as the 'Authorization' HTTP header</li>
<li><code>headers</code> (optional): key-value map of extra headers to pass in each HTTP call</li>
<li><code>allow_invalid_certs</code> (optional): a flag to skip TLS cert validation (usually for self-signed certs).</li>
<li><code>timeout</code> (optional): the timeout value for the HTTP response in milliseconds. Default value is <code>30000</code>.</li>
<li><code>error_policy</code> (optional): either <code>Continue</code> or <code>Exit</code>. Default value is <code>Exit</code>.</li>
<li><code>retry_policy</code> (optional): controls the policy to retry failed requests (see <a href="sinks/../advanced/retry_policy.html">retry policy</a>)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logs"><a class="header" href="#logs">Logs</a></h1>
<p>A sink that saves events into the file system. Each event is json-encoded and appended to the of a text file. Files are rotated once they reach a certain size. Optionally, old files can be automatically compressed once they have rotated.</p>
<h2 id="configuration-9"><a class="header" href="#configuration-9">Configuration</a></h2>
<p>Example sink section config</p>
<pre><code class="language-toml">[sink]
type = &quot;Logs&quot;
output_path = &quot;/var/oura/mainnet&quot;
output_format = &quot;JSONL&quot;
max_bytes_per_file = 1_000_000
max_total_files = 10
compress_files = true
</code></pre>
<h3 id="section-sink-2"><a class="header" href="#section-sink-2">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>Logs</code>.</li>
<li><code>output_path</code>: the path-like prefix for the output log files</li>
<li><code>output_format</code> (optional): specified the type of syntax to use for the serialization of the events. Only available option at the moment is <code>JSONL</code> (json + line break)</li>
<li><code>max_bytes_per_file</code> (optional): the max amount of bytes to add in a file before rotating it</li>
<li><code>max_total_files</code> (optional): the max amount of files to keep in the file system before start deleting the old ones</li>
<li><code>compress_files</code> (optional): a boolean indicating if the rotated files should be compressed.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aws-sqs"><a class="header" href="#aws-sqs">AWS SQS</a></h1>
<p>A sink that sends each event as a message to an AWS SQS queue. Each event is json-encoded and sent to a configurable SQS queue using AWS API endpoints.</p>
<p>The sink will process each incoming event in sequence and submit the corresponding <code>SendMessage</code> request to the SQS API. Once the queue acknowledges reception of the message, the sink will advance and continue with the following event.</p>
<p>The sink support both FIFO and Standard queues. The sink configuration will determine which logic to apply. In case of FIFO, the group id is determined by an explicit configuration value and the message id is defined by the fingerprint value of the event (Fingerprint filter needs to be enabled). </p>
<p>The sink uses AWS SDK's built-in retry logic which can be configured at the sink level. Authentication against AWS is built-in in the SDK library and follows the common chain of providers (env vars, ~/.aws, etc). </p>
<h2 id="configuration-10"><a class="header" href="#configuration-10">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;AwsSqs&quot;
region = &quot;us-west-2&quot;
queue_url = &quot;https://sqs.us-west-2.amazonaws.com/xxxxxx/my-queue&quot;
fifo = true
group_id = &quot;my_group&quot;
max_retries = 5
</code></pre>
<h3 id="section-sink-3"><a class="header" href="#section-sink-3">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>AwsSqs</code>.</li>
<li><code>region</code>: The AWS region where the queue is located.</li>
<li><code>queue_url</code>: The SQS queue URL provided by AWS (not to be confused with the ARN).</li>
<li><code>fifo</code>: A flag to determine if the queue is of type FIFO.</li>
<li><code>group_id</code>: A fixed group id to be used when sending messages to a FIFO queue.</li>
<li><code>max_retries</code>: The max number of send retries before exiting the pipeline with an error.</li>
</ul>
<h2 id="aws-credentials"><a class="header" href="#aws-credentials">AWS Credentials</a></h2>
<p>The sink needs valid AWS credentials to interact with the cloud service. The majority of the SDKs and libraries that interact with AWS follow the same approach to access these credentials from a chain of possible providers:</p>
<ul>
<li>Credentials stored as the environment variables AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY.</li>
<li>A Web Identity Token credentials from the environment or container (including EKS)</li>
<li>ECS credentials (IAM roles for tasks)</li>
<li>As entries in the credentials file in the .aws directory in your home directory (~/.aws/)</li>
<li>From the EC2 Instance Metadata Service (IAM Roles attached to an instance)</li>
</ul>
<p>Oura, by mean of the Rust AWS SDK lib, will honor the above chain of providers. Use any of the above that fits your particular scenario. Please refer to AWS' documentation for more detail.</p>
<h2 id="fifo-vs-standard-queues"><a class="header" href="#fifo-vs-standard-queues">FIFO vs Standard Queues</a></h2>
<p>Oura processes messages maintaining the sequence of the blocks and respecting the order of the transactions within the block. An AWS SQS FIFO queue provides the consumer with a guarantee that the order in which messages are consumed matches the order in which they were sent.</p>
<p>Connecting Oura with a FIFO queue would provide the consumer with the guarantee that the events received follow the same order as they appeared in the blockchain. This might be useful, for example, in scenarios where the processing of an event requires a reference of a previous state of the chain.</p>
<p>Please note that rollback events might happen upstream, at the blockchain level, which need to be handled by the consumer to unwind any side-effects of the processing of the newly orphaned blocks. This problem can be mitigated by using Oura's <a href="sinks/../advanced/rollback_buffer.html">rollback buffer</a> feature.</p>
<p>If each event can be processed in isolation, if the process is idempotent or if the order doesn't affect the outcome, the recommended approach is to use a Standard queue which provides &quot;at least once&quot; processing guarantees, relaxing the constraints and improving the overall performance.</p>
<h2 id="payload-size-limitation"><a class="header" href="#payload-size-limitation">Payload Size Limitation</a></h2>
<p>AWS SQS service has a 256kb payload size limit. This is more than enough for individual events, but it might be too little for pipelines where the <code>include_cbor_hex</code> option is enabled. If your goal of your pipeline is to access the raw CBOR content, we recommend taking a look at the <a href="sinks/./aws_s3.html">AWS S3 Sink</a> that provides a direct way for storing CBOR block in an S3 bucket.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aws-lambda"><a class="header" href="#aws-lambda">AWS Lambda</a></h1>
<p>A sink that invokes an AWS Lambda function for each received event. Each event is json-encoded and sent to a configurable function using AWS API endpoints.</p>
<p>The sink will process each incoming event in sequence, invoke the specified function and wait for the response.</p>
<p>A retry mechanism is available for failures to dispatch the call, but not for failures within the execution of the function. Regardless of the success or not of the function, the sink will advance and continue with the following event. </p>
<p>Authentication against AWS is built-in in the SDK library and follows the common chain of providers (env vars, ~/.aws, etc). </p>
<h2 id="configuration-11"><a class="header" href="#configuration-11">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;AwsLambda&quot;
region = &quot;us-west-2&quot;
function_name = &quot;arn:aws:lambda:us-west-2:xxxxx:function:my-func&quot;
max_retries = 5
</code></pre>
<h3 id="section-sink-4"><a class="header" href="#section-sink-4">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>AwsLambda</code>.</li>
<li><code>region</code>: The AWS region where the function is located.</li>
<li><code>function_name</code>: The ARN of the function we wish to invoke.</li>
<li><code>max_retries</code>: The max number of send retries before exiting the pipeline with an error.</li>
</ul>
<h2 id="aws-credentials-1"><a class="header" href="#aws-credentials-1">AWS Credentials</a></h2>
<p>The sink needs valid AWS credentials to interact with the cloud service. The majority of the SDKs and libraries that interact with AWS follow the same approach to access these credentials from a chain of possible providers:</p>
<ul>
<li>Credentials stored as the environment variables AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY.</li>
<li>A Web Identity Token credentials from the environment or container (including EKS)</li>
<li>ECS credentials (IAM roles for tasks)</li>
<li>As entries in the credentials file in the .aws directory in your home directory (~/.aws/)</li>
<li>From the EC2 Instance Metadata Service (IAM Roles attached to an instance)</li>
</ul>
<p>Oura, by mean of the Rust AWS SDK lib, will honor the above chain of providers. Use any of the above that fits your particular scenario. Please refer to AWS' documentation for more detail.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aws-s3"><a class="header" href="#aws-s3">AWS S3</a></h1>
<p>A sink that saves the CBOR content of the blocks as S3 object.</p>
<p>The sink will process each incoming event in sequence and select only the events of type <code>Block</code>. The CBOR content of the block will be extracted and saves as an S3 object in a configurable bucket in either hex or binary encoding. </p>
<p>A configurable option allows the user to decide how to name the object using values from the block header (such as epoch, slot, hash, etc). The properties of the block will be saved as metadata of the S3 Object for later identification (eg: block number, hash, slot, etc).</p>
<p>The sink uses AWS SDK's built-in retry logic which can be configured at the sink level. Authentication against AWS is built-in in the SDK library and follows the common chain of providers (env vars, ~/.aws, etc). </p>
<h2 id="configuration-12"><a class="header" href="#configuration-12">Configuration</a></h2>
<pre><code class="language-toml">[sink]
type = &quot;AwsS3&quot;
region = &quot;us-west-2&quot;
bucket = &quot;my-bucket&quot;
prefix = &quot;mainnet/&quot;
naming = &quot;SlotHash&quot;
content = &quot;Cbor&quot;
max_retries = 5
</code></pre>
<h3 id="section-sink-5"><a class="header" href="#section-sink-5">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>AwsS3</code>.</li>
<li><code>function_name</code>: The ARN of the function we wish to invoke.</li>
<li><code>region</code>: The AWS region where the bucket is located.</li>
<li><code>bucket</code>: The name of the bucket to store the blocks.</li>
<li><code>prefix</code>: A prefix to prepend on each object's key.</li>
<li><code>naming</code>: One of the available naming conventions (see section below)</li>
<li><code>content</code>: Either <code>Cbor</code> for binary encoding or <code>CborHex</code> for plain text hex representation of the CBOR</li>
<li><code>max_retries</code>: The max number of send retries before exiting the pipeline with an error.</li>
</ul>
<p>IMPORTANT: For this sink to work correctly, the <code>include_block_cbor</code> option should be enabled in the source sink configuration (see <a href="sinks/../advanced/mapper_options.html">mapper options</a>).</p>
<h2 id="naming-convention"><a class="header" href="#naming-convention">Naming Convention</a></h2>
<p>S3 Buckets allow the user to query by object prefix. It's important to use a naming convention that is compatible with the types of filters that the consumer intends to use. This sink provides the following options:</p>
<ul>
<li><code>Hash</code>: formats the key using <code>&quot;{hash}&quot;</code></li>
<li><code>SlotHash</code>: formats the key using <code>&quot;{slot}.{hash}&quot;</code></li>
<li><code>BlockHash</code>: formats the key using <code>&quot;{block_num}.{hash}&quot;</code></li>
<li><code>EpochHash</code>: formats the key using <code>&quot;{epoch}.{hash}&quot;</code></li>
<li><code>EpochSlotHash</code>: formats the key using <code>&quot;{epoch}.{slot}.{hash}&quot;</code></li>
<li><code>EpochBlockHash</code>: formats the key using <code>&quot;{epoch}.{block_num}.{hash}&quot;</code></li>
</ul>
<h2 id="content-encoding"><a class="header" href="#content-encoding">Content Encoding</a></h2>
<p>The sink provides two options for encoding the content of the object:</p>
<ul>
<li><code>Cbor</code>: the S3 object will contain the raw, unmodified CBOR value in binary format. The content type of the object in this case will be &quot;application/cbor&quot;. </li>
<li><code>CborHex</code>: the S3 object will contain the CBOR payload of the block encoded as a hex string. The content type of the object in this case will be &quot;text/plain&quot;. </li>
</ul>
<h2 id="metadata"><a class="header" href="#metadata">Metadata</a></h2>
<p>The sink uses the data from the block event to populate metadata fields of the S3 object for easier identification of the block once persisted:</p>
<ul>
<li><code>era</code></li>
<li><code>issuer_vkey</code></li>
<li><code>tx_count</code></li>
<li><code>slot</code></li>
<li><code>hash</code></li>
<li><code>number</code></li>
<li><code>previous_hash</code></li>
</ul>
<p>Please note that S3 doesn't allow filtering by metadata. For efficient filter, the only option available is to use the prefix of the key.</p>
<h2 id="aws-credentials-2"><a class="header" href="#aws-credentials-2">AWS Credentials</a></h2>
<p>The sink needs valid AWS credentials to interact with the cloud service. The majority of the SDKs and libraries that interact with AWS follow the same approach to access these credentials from a chain of possible providers:</p>
<ul>
<li>Credentials stored as the environment variables AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY.</li>
<li>A Web Identity Token credentials from the environment or container (including EKS)</li>
<li>ECS credentials (IAM roles for tasks)</li>
<li>As entries in the credentials file in the .aws directory in your home directory (~/.aws/)</li>
<li>From the EC2 Instance Metadata Service (IAM Roles attached to an instance)</li>
</ul>
<p>Oura, by mean of the Rust AWS SDK lib, will honor the above chain of providers. Use any of the above that fits your particular scenario. Please refer to AWS' documentation for more detail.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="redis-streams"><a class="header" href="#redis-streams">Redis Streams</a></h1>
<p>A sink that outputs events into <em>Redis Stream</em>.</p>
<p><em>Redis Streams</em> works as an append-only log where multiple consumers can read from the same queue while keeping independent offsets (as opposed to a PubSub topic where one subscriber affect the other). You can learn more about the <em>Streams</em> feature in the official <a href="https://redis.io/docs/manual/data-types/streams">Redis Documentation</a>.</p>
<p>This sink will process incoming events and send a JSON-encoded message of the payload for each one using the <code>XADD</code> command. The Redis instance can be local or remote.</p>
<h2 id="configuration-13"><a class="header" href="#configuration-13">Configuration</a></h2>
<p>Example configuration that sends all events into a single stream named <code>mystream</code> of a Redis instance running in port 6379 of the localhost.</p>
<pre><code class="language-toml">[sink]
type = &quot;Redis&quot;
redis_server = &quot;redis://localhost:6379&quot;
stream_name = &quot;mystream&quot;
</code></pre>
<p>Example configuration that sends events into different streams (named by the type of event) of a Redis instance running in port 6379 of the localhost.</p>
<pre><code class="language-toml">[sink]
type = &quot;Redis&quot;
redis_server = &quot;redis://localhost:6379&quot;
stream_strategy = &quot;ByEventType&quot;
</code></pre>
<h3 id="section-sink-6"><a class="header" href="#section-sink-6">Section: <code>sink</code></a></h3>
<ul>
<li><code>type</code>: the literal value <code>Redis</code>.</li>
<li><code>redis_server</code>: the redis server in the format <code>redis://[&lt;username&gt;][:&lt;password&gt;]@&lt;hostname&gt;[:port][/&lt;db&gt;]</code></li>
<li><code>stream_name</code> : the name of the redis stream for StreamStrategy <code>None</code>, default is &quot;oura&quot; if not specified</li>
<li><code>stream_strategy</code> : <code>None</code> or <code>ByEventType</code></li>
</ul>
<h2 id="conventions"><a class="header" href="#conventions">Conventions</a></h2>
<p>It is possible to send all Event to a single stream or create multiple streams, one for each event type. By appling the <a href="sinks//filters/selection">selection</a> filter it is possible to define the streams which should be created. </p>
<p>The sink uses the default Redis convention to define the unique entry ID for each message sent to the stream ( <code>&lt;millisecondsTime&gt;-&lt;sequenceNumber&gt;</code>).</p>
<p>Messages in Redis Streams are required to be <code>hashes</code> (maps between the string fields and the string values). This sink will serialize the event into a single-entry map with the following parts:</p>
<ul>
<li><code>key</code>: the <a href="sinks//filters/fingerprint">fingerprint</a> value if available, or the event type name.</li>
<li><code>value</code>: the json-encoded payload of the event.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reference"><a class="header" href="#reference">Reference</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-dictionary"><a class="header" href="#data-dictionary">Data Dictionary</a></h1>
<p><em>Oura</em> follows a Cardano chain and outputs events. Each event contains data about itself and about the <em>context</em> in which it occurred.</p>
<p>A consumer aggregating a sequence of multiple events will notice redundant / duplicated data. For example, the &quot;block number&quot; value will appear repeated in the context of every event of the same block. This behavior is intended, making each event a self-contained record is an architectural decision. We favor &quot;consumption ergonomics&quot; over &quot;data normalization&quot;.</p>
<h2 id="available-events"><a class="header" href="#available-events">Available Events</a></h2>
<p>The following list represent the already implemented events. These data structures are represented as an <code>enum</code> at the code level.</p>
<h3 id="rollback-event"><a class="header" href="#rollback-event"><code>RollBack</code> Event</a></h3>
<p>Data on chain rollback(The result of the local node switching to the consensus chains).</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_slot</td><td style="text-align: left">u64</td><td style="text-align: left">Slot of the rolled back block.</td></tr>
<tr><td style="text-align: left">block_hash</td><td style="text-align: left">String</td><td style="text-align: left">Hash of the rolled back block.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="block-event"><a class="header" href="#block-event"><code>Block</code> Event</a></h3>
<p>Data on an issued block.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">body_size</td><td style="text-align: left">usize</td><td style="text-align: left">Size of the block.</td></tr>
<tr><td style="text-align: left">issuer_vkey</td><td style="text-align: left">String</td><td style="text-align: left">Block issuer Public verification key.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="transaction-event"><a class="header" href="#transaction-event"><code>Transaction</code> Event</a></h3>
<p>Data on a transaction.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">fee</td><td style="text-align: left">u64</td><td style="text-align: left">Transaction fees in lovelace.</td></tr>
<tr><td style="text-align: left">ttl</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Transaction time to live.</td></tr>
<tr><td style="text-align: left">validity_interval_start</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Start of transaction validity interval</td></tr>
<tr><td style="text-align: left">network_id</td><td style="text-align: left">Option&lt;u32&gt;</td><td style="text-align: left">Network ID.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="txinput-event"><a class="header" href="#txinput-event"><code>TxInput</code> Event</a></h3>
<p>Data on a transaction input.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">tx_id</td><td style="text-align: left">String</td><td style="text-align: left">Transaction ID.</td></tr>
<tr><td style="text-align: left">index</td><td style="text-align: left">u64</td><td style="text-align: left">Index of input in transaction inputs.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
<tr><td style="text-align: left">input_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Input ID.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="txoutput-event"><a class="header" href="#txoutput-event"><code>TxOutput</code> Event</a></h3>
<p>Data on a transaction output (UTXO).</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">address</td><td style="text-align: left">String</td><td style="text-align: left">Address of UTXO.</td></tr>
<tr><td style="text-align: left">amount</td><td style="text-align: left">u64</td><td style="text-align: left">Amount of lovelace in UTXO.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
<tr><td style="text-align: left">output_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Output ID.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="outputasset-event"><a class="header" href="#outputasset-event"><code>OutputAsset</code> Event</a></h3>
<p>Data on a non-ADA asset in a UTXO.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">policy</td><td style="text-align: left">String</td><td style="text-align: left">Minting policy of asset.</td></tr>
<tr><td style="text-align: left">asset</td><td style="text-align: left">String</td><td style="text-align: left">Asset ID.</td></tr>
<tr><td style="text-align: left">amount</td><td style="text-align: left">u64</td><td style="text-align: left">Amount of asset.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
<tr><td style="text-align: left">output_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Output ID.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="metadata-event"><a class="header" href="#metadata-event"><code>Metadata</code> Event</a></h3>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">key</td><td style="text-align: left">String</td><td style="text-align: left">....</td></tr>
<tr><td style="text-align: left">subkey</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">....</td></tr>
<tr><td style="text-align: left">value</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">....</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="mint-event"><a class="header" href="#mint-event"><code>Mint</code> Event</a></h3>
<p>Data on the minting of a non-ADA asset.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">policy</td><td style="text-align: left">String</td><td style="text-align: left">Minting policy of asset.</td></tr>
<tr><td style="text-align: left">asset</td><td style="text-align: left">String</td><td style="text-align: left">Asset ID.</td></tr>
<tr><td style="text-align: left">quantity</td><td style="text-align: left">i64</td><td style="text-align: left">Quantity of asset minted.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="collateral-event"><a class="header" href="#collateral-event"><code>Collateral</code> Event</a></h3>
<p>Data on <a href="https://docs.cardano.org/plutus/collateral-mechanism">collateral inputs</a>.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">tx_id</td><td style="text-align: left">String</td><td style="text-align: left">Transaction ID.</td></tr>
<tr><td style="text-align: left">index</td><td style="text-align: left">u64</td><td style="text-align: left">Index of transaction input in inputs.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="plutusscriptref-event"><a class="header" href="#plutusscriptref-event"><code>PlutusScriptRef</code> Event</a></h3>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">data</td><td style="text-align: left">String</td><td style="text-align: left">....</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="stakeregistration-event"><a class="header" href="#stakeregistration-event"><code>StakeRegistration</code> Event</a></h3>
<p>Data on stake registration event.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">credential</td><td style="text-align: left"><a href="https://docs.rs/oura/1.4.1/oura/model/enum.StakeCredential.html">StakeCredential</a></td><td style="text-align: left">Staking credentials.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="stakederegistration-event"><a class="header" href="#stakederegistration-event"><code>StakeDeregistration</code> Event</a></h3>
<p>Data on stake deregistration event.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">credential</td><td style="text-align: left"><a href="https://docs.rs/oura/1.4.1/oura/model/enum.StakeCredential.html">StakeCredential</a></td><td style="text-align: left">Staking credentials.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="stakedelegation-event"><a class="header" href="#stakedelegation-event"><code>StakeDelegation</code> Event</a></h3>
<p>Data on <a href="https://docs.cardano.org/core-concepts/delegation">stake delegation</a> event.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">credential</td><td style="text-align: left"><a href="https://docs.rs/oura/1.4.1/oura/model/enum.StakeCredential.html">StakeCredential</a></td><td style="text-align: left">Stake credentials.</td></tr>
<tr><td style="text-align: left">pool_hash</td><td style="text-align: left">String</td><td style="text-align: left">Hash of stake pool ID.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="poolregistration-event"><a class="header" href="#poolregistration-event"><code>PoolRegistration</code> Event</a></h3>
<p>Data on the stake <a href="https://developers.cardano.org/docs/stake-pool-course/handbook/register-stake-pool-metadata/">registration event</a>.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">operator</td><td style="text-align: left">String</td><td style="text-align: left">Stake pool operator ID.</td></tr>
<tr><td style="text-align: left">vrf_keyhash</td><td style="text-align: left">String</td><td style="text-align: left">Kehash of node VRF operational key.</td></tr>
<tr><td style="text-align: left">pledge</td><td style="text-align: left">u64</td><td style="text-align: left">Stake pool pledge (lovelace).</td></tr>
<tr><td style="text-align: left">cost</td><td style="text-align: left">u64</td><td style="text-align: left">Operational costs per epoch (lovelace).</td></tr>
<tr><td style="text-align: left">margin</td><td style="text-align: left">f64</td><td style="text-align: left">Operator margin.</td></tr>
<tr><td style="text-align: left">reward_account</td><td style="text-align: left">String</td><td style="text-align: left">Account to receive stake pool rewards.</td></tr>
<tr><td style="text-align: left">pool_owners</td><td style="text-align: left">Vec&lt;String&gt;</td><td style="text-align: left">Stake pool owners.</td></tr>
<tr><td style="text-align: left">relays</td><td style="text-align: left">Vec&lt;String&gt;</td><td style="text-align: left">....</td></tr>
<tr><td style="text-align: left">pool_metadata</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">....</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="poolretirement-event"><a class="header" href="#poolretirement-event"><code>PoolRetirement</code> Event</a></h3>
<p>Data on <a href="https://cardano-foundation.gitbook.io/stake-pool-course/stake-pool-guide/stake-pool/retire_stakepool">stake pool retirement</a> event.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">pool</td><td style="text-align: left">String</td><td style="text-align: left">Pool ID.</td></tr>
<tr><td style="text-align: left">epoch</td><td style="text-align: left">u64</td><td style="text-align: left">Current epoch.</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="genesiskeydelegation-event"><a class="header" href="#genesiskeydelegation-event"><code>GenesisKeyDelegation</code> Event</a></h3>
<p>Data on genesis key delegation.</p>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Current slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><br />
<br />
<hr />
<h3 id="moveinstantaneousrewardscert-event"><a class="header" href="#moveinstantaneousrewardscert-event"><code>MoveInstantaneousRewardsCert</code> Event</a></h3>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">from_reserves</td><td style="text-align: left">bool</td><td style="text-align: left">....</td></tr>
<tr><td style="text-align: left">from_treasury</td><td style="text-align: left">bool</td><td style="text-align: left">....</td></tr>
<tr><td style="text-align: left">to_stake_credentials</td><td style="text-align: left">Option&lt;BTreeMap&lt;StakeCredential, i64&gt;&gt;</td><td style="text-align: left">....</td></tr>
<tr><td style="text-align: left">to_other_pot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">....</td></tr>
</tbody></table>
</div>
<p><strong>Context</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">block_number</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Height of block from genesis.</td></tr>
<tr><td style="text-align: left">slot</td><td style="text-align: left">Option&lt;u64&gt;</td><td style="text-align: left">Blockchain slot.</td></tr>
<tr><td style="text-align: left">tx_idx</td><td style="text-align: left">Option&lt;usize&gt;</td><td style="text-align: left">Transaction Index.</td></tr>
<tr><td style="text-align: left">tx_hash</td><td style="text-align: left">Option&lt;String&gt;</td><td style="text-align: left">Transaction hash.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-features"><a class="header" href="#advanced-features">Advanced Features</a></h1>
<p>This section provides detailed information on the some of the advanced features available in Oura:</p>
<ul>
<li><a href="advanced/./stateful_cursor.html">Stateful Cursor</a>: provides a mechanism to persist the &quot;position&quot; of the processing pipeline to make it resilient to restarts.</li>
<li><a href="advanced/./rollback_buffer.html">Rollback Buffer</a>: provides a way to mitigate the impact of chain rollbacks in downstream stages.</li>
<li><a href="advanced/./pipeline_metrics.html">Pipeline Metrics</a>: allows operators to track the progress and performance of long-running Oura sessions.</li>
<li><a href="advanced/./mapper_options.html">Mapper Options</a>: A set of &quot;expensive&quot; event mapping procedures that require an explicit opt-in to be activated.</li>
<li><a href="advanced/./intersect_options.html">Intersect Options</a>: Advanced options for instructing Oura from which point in the chain to start reading from.</li>
<li><a href="advanced/./custom_network.html">Custom Network</a>: Instructions on how to configure Oura for connecting to a custom network.</li>
<li><a href="advanced/./retry_policy.html">Retry Policy</a>: Instructions on how to configure retry policies for different operations</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stateful-cursor"><a class="header" href="#stateful-cursor">Stateful Cursor</a></h1>
<p>The <em>cursor</em> feature provides a mechanism to persist the &quot;position&quot; of the processing pipeline to make it resilient to restarts.</p>
<h2 id="context"><a class="header" href="#context">Context</a></h2>
<p>When running in daemon mode, a restart of the process will make Oura start crawling from the initially configured point. This default behavior can be problematic depending on the use-case of the operator.</p>
<p>An scenario where continuous &quot;coverage&quot; of all the processed blocks is important (eg: building a stateful view of the chain), it's prohibitive to have &quot;gaps&quot; while procesing. If Oura is configure to start from the &quot;tip&quot; of the chain, a restart of the process might miss some blocks during the bootstrap procedure.</p>
<p>A valid workaround to the above problem is to configure Oura to start from a fixed point in the chain. If a restart occurs, the pipeline will re-process the blocks, ensuring that each block was processed at least once. When working with sinks that implement idempotency when processing an event, receiving data from the same block multiple times should not impose a problem.</p>
<p>Although valid, the workaround described above is very inefficient. If the fixed point at which the pipeline starts is too far behind, catching up could take several hours, wasting time and resource.</p>
<h2 id="feature"><a class="header" href="#feature">Feature</a></h2>
<p>Oura implements an optional stateful cursor that receives notifications from the sink stage of the pipeline to continuously track the current position of the chain. At certain checkpoints (every 10 secs by default), the position is persisted onto the file system at a configurable location.</p>
<p>Assuming that a restart occurs and the cursor feature is enabled, the process will attempt to locate and load the persisted value and instruct the source stage to begin reading chain data from the last known position. </p>
<h2 id="configuration-14"><a class="header" href="#configuration-14">Configuration</a></h2>
<p>The <em>cursor</em> feature is a configurable setting available when running in daemon mode. A top level <code>[cursor]</code> section of the daemon toml file controls the feature:</p>
<pre><code class="language-toml">[cursor]
type = &quot;File&quot;
path = &quot;/var/oura/cursor&quot;
</code></pre>
<ul>
<li><code>[cursor]</code>: The presence of this section in the toml file indicates Oura to enable the <em>cursor</em> feature.</li>
<li><code>type</code>: The type of persistence backend to use for storing the state of the cursor. The only available option at the moment is <code>File</code>, which stores the cursor in the file system.</li>
<li><code>path</code>: The location of the cursor file within the file system. Default value is <code>var/oura/cursor</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rollback-buffer"><a class="header" href="#rollback-buffer">Rollback Buffer</a></h1>
<p>The &quot;rollback buffer&quot; feature provides a way to mitigate the impact of chain rollbacks in downstream stages of the data-processing pipeline.</p>
<h2 id="context-1"><a class="header" href="#context-1">Context</a></h2>
<p>Handling rollbacks in a persistent storage requires clearing the orphaned data / blocks before adding new records. The complexity of this process may vary by concrete storage engine, but it always has an associated impact on performance. In some scenarios, it might even be prohibitive to process events without a reasonable level of confidence about the immutability of the record.</p>
<p>Rollbacks occur frequently under normal conditions, but the chances of a block becoming orphaned diminishes as the depth of the block increases. Some Oura use-cases may benefit from this property, some pipelines might prefer lesser rollback events, even if it means waiting for a certain number of confirmations.</p>
<h2 id="feature-1"><a class="header" href="#feature-1">Feature</a></h2>
<p>Oura provides a &quot;rollback buffer&quot; that will hold blocks in memory until they reach a certain depth. Only blocks above a min depth threshold will be sent down the pipeline. If a rollback occurs and the intersection is within the scope of the buffer, the rollback operation will occur within memory, totally transparent to the subsequent stages of the pipeline.</p>
<p>If a rollback occurs and the intersection is outside of the scope of the buffer, Oura will fallback to the original behaviour and publish a RollbackEvent so that the &quot;sink&quot; stages may handle the rollback procedure manually.</p>
<h2 id="trade-off"><a class="header" href="#trade-off">Trade-off</a></h2>
<p>There's an obvious trade-off to this approach: latency. A pipeline will not process any events until the buffer fills up. Once the initial wait is over, the throughput of the whole pipeline should be equivalent to having no buffer at all (due to Oura's &quot;pipelining&quot; nature). If a rollback occurs, an extra delay will be required to fill the buffer again.</p>
<p>Notice that even if the throughput isn't affected, the latency (measured as the delta between the timestamp at which the event reaches the &quot;sink&quot; stage and the original timestamp of the block) will always be affected by a fixed value proportional to the size of the buffer.</p>
<h2 id="implementation-details"><a class="header" href="#implementation-details">Implementation Details</a></h2>
<p>The buffer logic is implemented in pallas-miniprotocols library. It works by keeping a VecDeque data structure of chain &quot;points&quot;, where roll-forward operations accumulate at the end of the deque and retrieving confirmed points means popping from the front of the deque.</p>
<h2 id="configuration-15"><a class="header" href="#configuration-15">Configuration</a></h2>
<p>The min depth is a configurable setting available when running in daemon mode. Higher min_depth values will lower the chances of experiencing a rollback event, at the cost of adding more latency. An node-to-node source stage config would look like this:</p>
<pre><code class="language-toml">[source]
type = &quot;N2N&quot;
address = [&quot;Tcp&quot;, &quot;relays-new.cardano-mainnet.iohk.io:3001&quot;]
magic = &quot;mainnet&quot;
min_depth = 6
</code></pre>
<p>Node-to-client sources provide an equivalent setting.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pipeline-metrics"><a class="header" href="#pipeline-metrics">Pipeline Metrics</a></h1>
<p>The <em>metrics</em> features allows operators to track the progress and performance of long-running Oura sessions.</p>
<h2 id="context-2"><a class="header" href="#context-2">Context</a></h2>
<p>Some use-cases require Oura to be running either continuosuly or for prolonged periods of time. Keeping a sink updated in real-time requires 24/7 operation. Dumping historical chain-data from origin might take several hours.</p>
<p>These scenarios require an understanding of the internal state of the pipeline to facilitate monitoring and troubleshooting of the system. In a data-processing pipeline such as this, two important aspects need to observable: progress and performance.</p>
<h2 id="feature-2"><a class="header" href="#feature-2">Feature</a></h2>
<p>Oura provides an optional <code>/metrics</code> HTTP endpoint that uses Prometheus format to expose real-time opertional metrics of the pipeline. Each stage (source / sink) is responsible for notifying their progress as they process each event. This notifications are then aggregated via counters &amp; gauges and exposed via HTTP using the well-known Prometheus encoding.</p>
<p>The following metrics are available:</p>
<ul>
<li><code>chain_tip</code>: the last detected tip of the chain (height)</li>
<li><code>rollback_count</code>: number of rollback events occurred</li>
<li><code>source_current_slot</code>: last slot processed by the source of the pipeline</li>
<li><code>source_current_height</code>: last height (block #) processed by the source of the pipeline</li>
<li><code>source_event_count</code>: number of events processed by the source of the pipeline</li>
<li><code>sink_current_slot</code>: last slot processed by the sink of the pipeline</li>
<li><code>sink_event_count</code>: number of events processed by the sink of the pipeline</li>
</ul>
<h2 id="configuration-16"><a class="header" href="#configuration-16">Configuration</a></h2>
<p>The <em>metrics</em> feature is a configurable setting available when running in daemon mode. A top level <code>[metrics]</code> section of the daemon toml file controls the feature:</p>
<pre><code class="language-toml"># daemon.toml file

[metrics]
address = &quot;0.0.0.0:9186&quot;
endpoint = &quot;/metrics&quot;
</code></pre>
<ul>
<li><code>[metrics]</code> section needs to be present to enable the feature. Absence of the section will not expose any HTTP endpoints.</li>
<li><code>address</code>: The address at which the HTTP server will be listening for request. Expected format is <code>&lt;ip&gt;:&lt;port&gt;</code>. Use the IP value <code>0.0.0.0</code> to allow connections on any of the available IP address of the network interface. Default value is <code>0.0.0.0:9186</code>.</li>
<li><code>endpoint</code>: The path at which the metrics will be exposed. Default value is <code>/metrics</code>.</li>
</ul>
<h2 id="usage-3"><a class="header" href="#usage-3">Usage</a></h2>
<p>Once enabled, a quick method to check the metrics output is to navigate to the HTTP endpoint using any common browser. A local instance of Oura with metrics enabled on port <code>9186</code> can be accessed by opening the URL http://localhost:9186</p>
<p>An output similar to the following should be shown by the browser:</p>
<pre><code># HELP chain_tip the last detected tip of the chain (height)
# TYPE chain_tip gauge
chain_tip 6935733
# HELP rollback_count number of rollback events occurred
# TYPE rollback_count counter
rollback_count 1
# HELP sink_current_slot last slot processed by the sink of the pipeline
# TYPE sink_current_slot gauge
sink_current_slot 2839340
# HELP sink_event_count number of events processed by the sink of the pipeline
# TYPE sink_event_count counter
sink_event_count 2277714
# HELP source_current_height last height (block #) processed by the source of the pipeline
# TYPE source_current_height gauge
source_current_height 2837810
# HELP source_current_slot last slot processed by the source of the pipeline
# TYPE source_current_slot gauge
source_current_slot 2839340
# HELP source_event_count number of events processed by the source of the pipeline
# TYPE source_event_count counter
source_event_count 2277715
</code></pre>
<p>Regardless of the above mechanism, the inteded approach for tracking Oura's metrics is to use a monitoring infrastructure compatible with Prometheus format. Setting up and managing the monitoring stack is outside the scope of Oura. If you don't have any infrastructure in place, we recommend checking out some of the more commons stacks:</p>
<ul>
<li>Prometheus Server + Grafana</li>
<li>Metricbeat + Elasticsearch + Kibana</li>
<li>Telegraf + InfluxDB + Chronograf</li>
</ul>
<p>The following screenshot is an example of a <em>Grafana</em> dashboard showing Prometheus data scraped from an Oura instance:</p>
<p><img src="advanced/grafana.png" alt="Grafana Dashboard" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mapper-options"><a class="header" href="#mapper-options">Mapper Options</a></h1>
<p>A set of &quot;expensive&quot; event mapping procedures that require an explicit opt-in to be activated.</p>
<h2 id="context-3"><a class="header" href="#context-3">Context</a></h2>
<p>One of the main concerns of Oura is turning block / tx data into atomic events to send down the pipeline for further processing. The <code>source</code> stage is responsible for executing these mapping procedures.</p>
<p>Most of the time, this logic is generic enough that it can be reused in different scenarios. For example, the <code>N2N</code> and the <code>N2C</code> sources share the same mapping procedures. If a particular use-case needs to cherry-pick, enrich or alter the data in some way, the recommendation is to handle the transformation in downstream stages, by using any of the built-in filter or by creating new ones.</p>
<p>There are some exceptions though, whenever a mapping has a heavy impact on performance, it is better to disable it completely at the <code>source</code> level to avoid paying the overhead associated with the initial processing of the data.</p>
<h2 id="feature-3"><a class="header" href="#feature-3">Feature</a></h2>
<p>We consider a mapping procedure &quot;expensive&quot; if it involves: handling a relative large amount of data, computing some relatively expensive value or generating redundant data required only for very particular use cases.</p>
<p>For these expensive procedures, we provide configurable options that instructs an Oura instance running in daemon mode to opt-in on each particular rule.</p>
<h2 id="configuration-17"><a class="header" href="#configuration-17">Configuration</a></h2>
<p>The mapper options can be defined by adding the following configuration in the <code>daemon.toml</code> file:</p>
<pre><code class="language-toml">[source.mapper]
include_block_end_events = &lt;bool&gt;
include_transaction_details = &lt;bool&gt;
include_transaction_end_events = &lt;bool&gt;
include_block_cbor = &lt;bool&gt;
include_byron_ebb = &lt;bool&gt;
</code></pre>
<ul>
<li><code>include_block_end_events</code>: if enabled, the source will output an event signaling the end of a block, duplicating all of the data already sent in the corresponding block start event. Default value is <code>false</code>.</li>
<li><code>include_transaction_details</code>: if enabled, each transaction event payload will contain an nested version of all of the details of the transaction (inputs, outputs, mint, assets, metadata, etc). Useful when the pipeline needs to process the tx as a unit, instead of handling each sub-object as an independent event. Default value is <code>false</code>.</li>
<li><code>include_transaction_end_events</code>: if enabled, the source will output an event signaling the end of a transaction, duplicating all of the data already sent in the corresponding transaction start event. Defaul value is <code>false</code>.</li>
<li><code>include_block_cbor</code>: if enabled, the block event will include the raw, unaltered cbor content received from the node, formatted as an hex string. Useful when some custom cbor decoding is required. Default value is <code>false</code>.</li>
<li><code>include_byron_ebb</code>: if enabled, a block event will be emmitted for legacy epoch boundary block of the Byron era (deprecated in newer eras). Useful when performing validation on previous block hashes. Default value is <code>false</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="intersect-options"><a class="header" href="#intersect-options">Intersect Options</a></h1>
<p>Advanced options for instructing Oura from which point in the chain to start reading from.</p>
<h2 id="feature-4"><a class="header" href="#feature-4">Feature</a></h2>
<p>When running in daemon mode, Oura provides 4 different strategies for finding the intersection point within the chain sync process.</p>
<ul>
<li><code>Origin</code>: Oura will start reading from the beginning of the chain.</li>
<li><code>Tip</code>: Oura will start reading from the current tip of the chain.</li>
<li><code>Point</code>: Oura will start reading from a particular point (slot, hash) in the chain. If the point is not found, the process will be terminated with a non-zero exit code.</li>
<li><code>Fallbacks</code>: Oura will start reading the first valid point within a set of alternative positions. If point is not valid, the process will fallback into the next available point in the list of options. If none of the points are valid, the process will be terminated with a non-zero exit code.</li>
</ul>
<p>The default strategy use by Oura is <code>Tip</code>, unless an alternative option is specified via configuration.</p>
<p>You can also define a finalizing point by providing a block hash at which oura will stop reading from the the chain and exit gracefully.</p>
<h2 id="configuration-18"><a class="header" href="#configuration-18">Configuration</a></h2>
<p>To modify the default behaviour used by the daemon mode, a section named <code>[source.intersect]</code> needs to be added in the <code>daemon.toml</code> file.</p>
<pre><code class="language-toml">[source.intersect]
type = &lt;Type&gt;
value = &lt;Value&gt;
</code></pre>
<ul>
<li><code>type</code>: Defines which strategy to use. Valid values are <code>Origin</code>, <code>Tip</code>, <code>Point</code>, <code>Fallbacks</code>. Default value is <code>Tip</code>.</li>
<li><code>value</code>: Either a point or an array of points to be used as argument for the selected strategy.</li>
</ul>
<p>If you'd like it to only sync an specific section of the chain, you can also instruct oura to stop syncing when it reaches an specific block hash by defining a <code>[source.finalize]</code> config:</p>
<pre><code class="language-toml">[source.finalize]
until_hash = &lt;BlockHash&gt;
</code></pre>
<p>Note that unlike the intersect point, no slot is provided for the finalizer.</p>
<h2 id="examples-5"><a class="header" href="#examples-5">Examples</a></h2>
<p>The following example show how to configure Oura to use a set of fallback intersection point. The chain sync process will attempt to first intersect at slot <code>4449598</code>. If not found, it will continue with slot <code>43159</code> and finally with slot <code>0</code>.</p>
<pre><code class="language-toml">[source.intersect]
type = &quot;Fallbacks&quot;
value = [
    [4449598, &quot;2c9ba2611c5d636ecdb3077fde754413c9d6141c6288109922790e53bbb938b5&quot;],
    [43159, &quot;f5d398d6f71a9578521b05c43a668b06b6103f94fcf8d844d4c0aa906704b7a6&quot;],
    [0, &quot;f0f7892b5c333cffc4b3c4344de48af4cc63f55e44936196f365a9ef2244134f&quot;],
]
</code></pre>
<p>This configuration will sync the whole Byron era only:</p>
<pre><code class="language-toml">[source.intersect]
type = &quot;Origin&quot;

[source.finalize]
until_hash = &quot;aa83acbf5904c0edfe4d79b3689d3d00fcfc553cf360fd2229b98d464c28e9de&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-networks"><a class="header" href="#custom-networks">Custom networks</a></h1>
<p>Instructions on how to configure Oura for connecting to a custom network (aka: other than mainnet / testnet).</p>
<h2 id="context-4"><a class="header" href="#context-4">Context</a></h2>
<p>Oura requires certain information about the chain it is reading from. In a way, this is similar to the json config files required to run the Cardano node. These values are used for procedures such as encoding bech32 addresses, computing wall-clock time for blocks, etc. </p>
<p>Since <code>mainnet</code> and <code>testnet</code> are well-known, heavily used networks, Oura hardcodes these values as part of the binary release so that the user is spared from having to manually specify them. On the other hand, custom networks require the user to configure these values manually for Oura to establish a connection.</p>
<h2 id="feature-5"><a class="header" href="#feature-5">Feature</a></h2>
<p>By adding a <code>[chain]</code> section in the daemon configuration file, users can provide the information required by Oura to connect to a custom network.</p>
<p>The <code>[chain]</code> section has the following propoerties:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">DataType</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">byron_epoch_length</td><td style="text-align: left">integer</td><td style="text-align: left">the length (in seconds) of a Byron epoch in this network</td></tr>
<tr><td style="text-align: left">byron_slot_length</td><td style="text-align: left">integer</td><td style="text-align: left">the length (in seconds) of a Byron slot in this network</td></tr>
<tr><td style="text-align: left">byron_known_slot</td><td style="text-align: left">integer</td><td style="text-align: left">the slot of a Byron block known to exist in this network</td></tr>
<tr><td style="text-align: left">byron_known_hash</td><td style="text-align: left">string</td><td style="text-align: left">the hash of the known Byron block</td></tr>
<tr><td style="text-align: left">byron_known_time</td><td style="text-align: left">integer</td><td style="text-align: left">the unix timestamp of the known Byron block</td></tr>
<tr><td style="text-align: left">shelley_epoch_length</td><td style="text-align: left">integer</td><td style="text-align: left">the length (in seconds) of a Shelley epoch in this network</td></tr>
<tr><td style="text-align: left">shelley_slot_length</td><td style="text-align: left">integer</td><td style="text-align: left">the length (in seconds) of a Shelley slot in this network</td></tr>
<tr><td style="text-align: left">shelley_known_slot</td><td style="text-align: left">integer</td><td style="text-align: left">the slot of a Shelley block known to exist in this network</td></tr>
<tr><td style="text-align: left">shelley_known_hash</td><td style="text-align: left">String</td><td style="text-align: left">the hash of the known Shelley block</td></tr>
<tr><td style="text-align: left">shelley_known_time</td><td style="text-align: left">integer</td><td style="text-align: left">the unix timestamp of the known Shelley block</td></tr>
<tr><td style="text-align: left">address_hrp</td><td style="text-align: left">string</td><td style="text-align: left">the human readable part for addresses of this network</td></tr>
<tr><td style="text-align: left">adahandle_policy</td><td style="text-align: left">string</td><td style="text-align: left">the minting policy for AdaHandle on this network.</td></tr>
</tbody></table>
</div>
<h2 id="examples-6"><a class="header" href="#examples-6">Examples</a></h2>
<h3 id="chain-information-for-testnet"><a class="header" href="#chain-information-for-testnet">Chain information for Testnet</a></h3>
<p>This example configuration shows the values for Testnet. Since testnet values are hardcoded as part of Oura's release, users are not required to input these exact values anywhere, but it serves as a good example of what the configuration looks like.</p>
<pre><code class="language-toml">[chain]
byron_epoch_length  = 432000
byron_slot_length = 20
byron_known_slot = 0
byron_known_hash = &quot;8f8602837f7c6f8b8867dd1cbc1842cf51a27eaed2c70ef48325d00f8efb320f&quot;
byron_known_time = 1564010416
shelley_epoch_length = 432000
shelley_slot_length = 1
shelley_known_slot = 1598400
shelley_known_hash = &quot;02b1c561715da9e540411123a6135ee319b02f60b9a11a603d3305556c04329f&quot;
shelley_known_time = 1595967616
address_hrp = &quot;addr_test&quot;
adahandle_policy = &quot;8d18d786e92776c824607fd8e193ec535c79dc61ea2405ddf3b09fe3&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retry-policy"><a class="header" href="#retry-policy">Retry Policy</a></h1>
<p>Advanced options for instructing Oura how to deal with failed attempts in certain sinks.</p>
<h2 id="supported-sinks"><a class="header" href="#supported-sinks">Supported Sinks</a></h2>
<ul>
<li><a href="advanced/../sinks/gcp_cloudfunction.html">GCP CloudFunction</a></li>
<li><a href="advanced/../sinks/gcp_pubsub.html">GCP PubSub</a></li>
<li><a href="advanced/../sinks/webhook.html">Webhook</a></li>
<li><a href="advanced/../sinks/elastic.html">Elasticsearch</a></li>
</ul>
<h2 id="configuration-19"><a class="header" href="#configuration-19">Configuration</a></h2>
<p>To modify the default behaviour used by the sink, a section named <code>[sink.retry_policy]</code> needs to be added in the <code>daemon.toml</code> file.</p>
<pre><code class="language-toml">[sink.retry_policy]
max_retries = 30
backoff_unit =  5000
backoff_factor = 2
max_backoff = 100000
</code></pre>
<ul>
<li><code>max_retries</code>: the max number of retries before failing the whole pipeline. Default value is <code>20</code></li>
<li><code>backoff_unit</code>: the delay expressed in milliseconds between each retry. Default value is <code>5000</code>.</li>
<li><code>backoff_factor</code>: the amount to increase the backoff delay after each attempt. Default value is <code>2</code>.</li>
<li><code>max_backoff</code>: the longest possible delay in milliseconds. Default value is <code>100000</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="guides"><a class="header" href="#guides">Guides</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cardano--kafka"><a class="header" href="#cardano--kafka">Cardano =&gt; Kafka</a></h1>
<p>This guide shows how to leverage <em>Oura</em> to stream data from a Cardano node into a <em>Kafka</em> topic.</p>
<h2 id="about-kafka"><a class="header" href="#about-kafka">About Kafka</a></h2>
<blockquote>
<p>Apache Kafka is a framework implementation of a software bus using stream-processing. It is an open-source software platform developed by the Apache Software Foundation written in Scala and Java.</p>
</blockquote>
<p>Find <a href="https://en.wikipedia.org/wiki/Apache_Kafka">more info</a> about <em>Kafka</em> in wikipedia or visit <em>Kafka's</em> official <a href="https://kafka.apache.org/">website</a></p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>This examples assumes the following prerequisites:</p>
<ul>
<li>A running Cardano node locally accesible via a unix socket.</li>
<li>A Kafka cluster accesible through the network.</li>
<li>An already existing Kafka topic where to output events</li>
<li><em>Oura</em> binary release installed in local system</li>
</ul>
<h2 id="instructions"><a class="header" href="#instructions">Instructions</a></h2>
<h3 id="1-create-an-oura-configuration-file-cardano2kafkatoml"><a class="header" href="#1-create-an-oura-configuration-file-cardano2kafkatoml">1. Create an Oura configuration file <code>cardano2kafka.toml</code></a></h3>
<pre><code class="language-toml">[source]
type = &quot;N2C&quot;
address = [&quot;Unix&quot;, &quot;/opt/cardano/cnode/sockets/node0.socket&quot;]
magic = &quot;testnet&quot;

[sink]
type = &quot;Kafka&quot;
brokers = [&quot;kafka-broker-0:9092&quot;]
topic = &quot;cardano-events&quot;
</code></pre>
<p>Some comments regarding the above configuration:</p>
<ul>
<li>the <code>[source]</code> section indicates <em>Oura</em> from where to pull chain data.
<ul>
<li>the <code>N2C</code> source type value tells <em>Oura</em> to get the data from a Cardano node using Node-to-Client mini-protocols (chain-sync instantiated to full blocks).</li>
<li>the <code>address</code> field indicates that we should connect via <code>Unix</code> socket at the specified path. This value should match the location of your local node socket path.</li>
<li>the <code>magic</code> field indicates that our node is running in the <code>testnet</code> network. Change this value to <code>mainnet</code> if appropriate.</li>
</ul>
</li>
<li>the <code>[sink]</code> section tells <em>Oura</em> where to send the information it gathered.
<ul>
<li>the <code>Kafka</code> sink type value indicates that <em>Oura</em> should use a <em>Kafka</em> producer client as the output</li>
<li>the <code>brokers</code> field indicates the location of the <em>Kafka</em> brokers within the network. Several hostname:port pairs can be added to the array for a &quot;cluster&quot; scenario.</li>
<li>the <code>topic</code> fields indicates which <em>Kafka</em> topic to used for the outbound messages.</li>
</ul>
</li>
</ul>
<h3 id="2-run-oura-in-daemon-mode"><a class="header" href="#2-run-oura-in-daemon-mode">2. Run <em>Oura</em> in <code>daemon</code> mode</a></h3>
<p>Run the following command from your terminal to start the daemon process:</p>
<pre><code class="language-sh">RUST_LOG=info oura daemon --config cardano2kafka.toml
</code></pre>
<p>You should see an output similar to the following:</p>
<pre><code>[2021-12-13T22:16:43Z INFO  oura::sources::n2n::setup] handshake output: Accepted(7, VersionData { network_magic: 764824073, initiator_and_responder_diffusion_mode: false })
[2021-12-13T22:16:43Z INFO  oura::sources::n2n::setup] chain point query output: Some(Tip(Point(47867448, &quot;f170baa5702c91b23580291c3a184195df7c77d3e1a03b3d6424793aacc850d6&quot;), 6624258))
[2021-12-13T22:16:43Z INFO  oura::sources::n2n::setup] node tip: Point(47867448,&quot;f170baa5702c91b23580291c3a184195df7c77d3e1a03b3d6424793aacc850d6&quot;)
[2021-12-13T22:16:44Z INFO  oura::sources::n2n] rolling block to point Point(47867448, &quot;f170baa5702c91b23580291c3a184195df7c77d3e1a03b3d6424793aacc850d6&quot;)
[2021-12-13T22:16:52Z INFO  oura::sources::n2n] requesting block fetch for point Some(Point(47867448, &quot;f170baa5702c91b23580291c3a184195df7c77d3e1a03b3d6424793aacc850d6&quot;))
[2021-12-13T22:17:15Z INFO  oura::sources::n2n] requesting block fetch for point Some(Point(47867448, &quot;f170baa5702c91b23580291c3a184195df7c77d3e1a03b3d6424793aacc850d6&quot;))
[2021-12-13T22:17:20Z INFO  oura::sources::n2n] requesting block fetch for point Some(Point(47867448, &quot;f170baa5702c91b23580291c3a184195df7c77d3e1a03b3d6424793aacc850d6&quot;))
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
